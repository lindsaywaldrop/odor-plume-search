---
title: "Supplemental Information to `Physical properties of odorants affect behavior of trained detection dogs during close-quarters searches'"
author: 
 - Daniel Mejia^1^, Lydia Burnett^2^, Nicholas Hebdon^1^, Peter Stevens^3^, Alexis Shiber^1^, Clay Cranston^1^, Lauryn DeGreeff^2^, and Lindsay D. Waldrop^1^ 
date: "`r Sys.Date()`"
output: 
  bookdown::pdf_document2:
    number_sections: false
    toc: false
    keep_tex: yes
bibliography: references.bib
csl: scientific-reports.csl
---

```{r setup, include=FALSE}
library(knitr)
library(tidyr)
library(kableExtra)
knitr::opts_chunk$set(echo = TRUE, fig.width=8)
options(knitr.graphics.error = FALSE)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
wd <- getwd()
filepath1 <- file.path(here::here(), "figures", "Trialbox1.png")
```
 
 1. Schmid College of Science and Technology, Chapman University
 2. Global Forensic and Justice Center and Department of Chemistry and Biochemistry, Florida International University
 3. The Scentsable K9, El Cajon, CA

Corresponding author: L.D. Waldrop waldrop@chapman.edu



## Methods

#### Materials 

Ammonium hydroxide (Sigma-Aldrich) and 2-etyhyl-1-hexanol (Sigma-Aldrich) were selected as the two target odorants of interest due to differences in their physical properties (Table \@ref(tab:chem-table)).

```{r chem-table, echo=FALSE}
properties <- data.frame("Property" = c("Molecular weight (g mol$^{-1}$)", 
                                        "Diffusion coefficent (cm$^2$ s $^{-1}$)",
                                        "Vapor pressure (atm)"), 
                        "2E1H" = c("130.23", "0.0663", "0.000179"), 
                        "NH3" = c( "17.031", "0.2403", "9.9"))
kable(properties, "simple", col.names = c("Property", "2E1H", "NH$_3$"), 
      align = "c", row.names = F,
      caption="Physical properties of the two target odorant chemicals, 2-ethyl-1-hexanol (2E1H) and ammonia (NH$_3$): molecular weight, diffusion coefficient and vapor pressure.")
```

In order to train the two different target odors, handlers were given controlled odor mimic permeation systems (COMPS) as training aids. COMPS are a tool that controls odor availability during training. For this study, each COMPS consists of 20 $\mu$L of analyte pipetted onto a 2 inch by 2 inch piece of cotton-blend gauze pad (Dukal, LLC) which was heat-sealed in a 2 by 3 inch plastic bag. The analyte is released at a rate determined by the thickness and surface area of the bag [@simon2019]. In order to equalize the amount of 2E1H and ammonia presented to the canine during training, a 3 MIL low density polyethylene bag (LDPE; Uline) was used 2E1H and a 8 MIL LDPE bag (Uline) was used for ammonia. Non-target or distractor odorants were prepared in a similar way for methyl benzoate (Sigma-Aldrich; 3 MIL bag) and bromooctane (Sigma-Aldrich; 8 MIL bag).


### Participants 

Fourteen civilian canines were recruited through the National Association of Canine Scent Work (NACSW)(TM). NACSW canines train to detect essential oils for competition. Canines recruited from Nosework 3 title or higher. Dogs at this level are trained to detect multiple odor sources, trials with blanks, and in various search situations.

Three small dogs ($< 30$ lbs) and eleven large dogs ($\geq 30$ lbs) were included of all different breeds (Table \@ref(tab:breed-table)). The handlers were not compensated for participation. The study observed all federal, state, and local regulations on the use of vertebrate animals in research (FIU IACUC protocol #201314).

### Training 

During the training period, handlers logged the time in which they used each COMPS and were instructed to throw away the COMPS and open a new one after it was exposed to the air for a total of six hours. Handler-dog teams were given six weeks to train with the COMPS before participating in the trials. Each handler-dog team trained individually as they would for typical Nosework odor competitions.

```{r breed-table, echo=FALSE}
column_names <- c("Dog number", "Breed", "Weight (lbs)")
breed_data <- read.csv("./data/kinematics/dog_sizes.csv")
breed_data <- breed_data[-c(2, 5, 8, 17, 18, 20:27),] #removing dogs that are not a part of this study
breed_data <- breed_data[, -3]
breed_data <- breed_data[order(breed_data$dog, decreasing = F),]
kable(breed_data, "simple", col.names = column_names, 
      align = "c", digits = 0, row.names = F, 
      caption = "Dog Participant Information")
```


### Experimental Setup and Procedure

The trial was held in Huntington Beach, California in February, 2023 at a dog training facility (The Hounds Grounds). The trial was held during the morning, which was cloudy and rainy (temperature 17$^{\circ}$C, 80% relative humidity). All HVAC remained off during the duration of the experiment such that the inside conditions were consistent with the outside conditions in terms of temperature and humidity. The main search area was separated from the front door by a four-foot high wooden wall, which limited much air movement in the main area when the outer doors opened and closed. Temperature, humidity, and wind conditions varied little during the three hours the trials were held.

Two plywood trials walls were set up in the middle of each location (Figure \@ref(fig:trial-box)). The walls consisted of three four foot by four foot panels of 1/2 inch plywood with two inch by three inch studs that were connected in a C pattern, the center panel of which contained four imprinting holes (3" interior, 4" exterior ABS  toilet flange; OATEY) spaced seven inches horizontally apart. One wall was for large dogs where the imprinting holes were placed 16 inches on center from ground; another was for small dogs and had the holes spaced seven inches on center from the ground. Each hole presented a single odorant to the dogs through a small opening on a plastic PVC cap. One COMPS was placed in three of the four holes,  containing one of two distracting odorants (either methyl benzoate or bromooctane) or one of the two target odorant (either 2E1H or NH~3~). A fourth hole had no odor (blank).

COMPS were placed in the imprinting devices five to ten minutes before dogs were allowed to interact with the wall. Dogs were then run consecutively. No special effort was made to reset or control the odor plume from the wall between dogs. After each run with a target odor, distracting-odor COMPS were replaced. The white, PVC cap and ABS imprinting hole were replaced between 2E1H and NH3 to limit cross-contamination between target odors. A 15- to 20-minute period between runs with each target odor was given to allow the previous odor plumes to dissipate. 

Dogs were allowed to search a similar imprinting wall with a Nosework odor source before and after each experimental run. Each dog was sent to their corresponding wall twice, once where the target odor was NH~3~ and the other when it was 2E1H. Two observers remained behind the dog and handler dyad while they were sent to the corresponding wall to note observations and to coach the handler, if needed. The handlers were blind to which hole contained the target odor. The handler was instructed to search the wall and indicate if their dog alerted to the location of the odor source. Once the dog had searched the wall and either alerted to the target odor or had worked the wall sufficiently, the dog-handler team was exited the facility. To assess whether the dogs were more successful at locating one odor or another, the successful versus unsuccessful alerts were noted by both observers during each run.


```{r trial-box, echo=FALSE, out.width="95%", fig.cap="Trial walls used for the experiment showing the relative placement of imprinting holes. Left: large wall, right: small wall. Left image shows side and top camera set up for capturing video data. Leashed dogs were allowed to interact with the wall freely. Photos by Monica Moljo."}
include_graphics(file.path(here::here(), "doc", "figures","trialbox2.png"))
```

```{r top-side-view, echo=FALSE, out.width="95%", fig.cap="Side (left) and top (right) views of the cameras during a search."}
include_graphics(file.path(here::here(), "doc","figures","top-side-view.png"))
```

Two video cameras (GoPro Hero 8 Black, GoPro, San Mateo, CA) were placed in view of the front of the wall where dogs interacted with odors, one above the holes and one to the right side of the trial wall, resulting in a top view and side view, respectively (Figure \@ref(fig:top-side-view)). Cameras were placed in linear mode using 30 frames per second to record at 4K resolution. Cameras ran continuously for the time that the dogs interacted with the wall area. Videos were calibrated with a three-dimensional calibration object on sight immediately before running dogs in the trial and for each wall (large and small). Cameras were synced using a verbal cue and aligned using iMovie during analysis. Calibration footage was taken each time the cameras were initially set up or moved. 


### Behavioral Analysis

To analyze the behaviors occurring along the search path, two ethograms were created to code behavioral stages related to searching and other, relevant individual behaviors that occurred during the search. Each ethogram was created using the Behavioral Observation Research Interactive Software (BORIS) and coded using the same software [@friard2016boris]. Behavior states and individual behaviors were scored by two trained observers (one for behavior states, one for individual behaviors). 

Using a combination of classical and operant conditioning, dogs are trained to behave a certain way once they have detected a target odor and are as close to the source of that odor as they can possibly get. The use of a detection dog and location of one or more of the target odors will typically go as follows:

  1.  The dog is deployed with a search command.  
  2.  __Casting stage__: the dog will start sampling the air currents trying to locate an odor plume (i.e., ``scent cone").  As air current carries the target odor, dogs locate the edges of the odor plume and try to find the source. The dog will move its head from side to side trying to locate the edges of the odor plume and the odor source.
  3.  __Localizing stage__: once the dog has detected the odor plume, it engages in noticeable changes of behavior. The dog often becomes visibly excited with its bodies becoming more rigid, changes in rates of breathing, and appear more focused. The dog will close its mouth, very focused sniffing occurs, and sniffing frequency increases. Sometimes the dog will appear to become frantic or engage in a sudden turn of the head.
  4.  __Alert phase__: after the dog has successfully located the source of the odor, the dog has been conditioned to perform a specific behavior, often called a Trained Final Response (TFR). The most common TFR's in professional detection work is a sit or freeze and in civilian sport detection is a head turn and look at the handler. The dog is then rewarded with a reinforcer. 

Behavioral stages were defined stages that correspond to the search stages explained above: casting, localizing, and alerting. An off-task stage was also added for times where the dog was not engaged in the search task. The current literature has agreed upon the three defined search phases in dogs defined in Thesen et al.[@thesen1993behaviour] (initial, deciding, and tracking phases), where each phase differs from the other based on speed, sniff frequency, and time spent sniffing. The addition and use of distinct casting and localizing stages in the current study bridges the gap in terminology from tracking and trailing to the wider olfactory literature, as well as remaining consistent with the stages outlined in Thesen et al. [@thesen1993behaviour; @weissburg1994odor; @settles2005sniffers; @belanger1996adaptive; @hepper2005many; @farkas1972chemical; @prada2018birds; @murlis1992odor; @gire2016mice; @reddy2022olfactory]. Therefore, the terms used in the current study better classify and describe the search stages dogs iterate through as they navigate the odor plumes they search. 


Individual behaviors were defined as distinct behaviors displayed independently of search stage and collected as both the number of incidents and amount of time the behaviors were displayed. The behaviors were selected after observations made during the trials and because they have been linked with psychological and physiological states of being, such as confusion, avoidance, anxiousness, focus, and alertness [@bodnariu2008indicators; @melco2020investigation; @beerda2000behavioural; @sinn2010personality; @thesen1993behaviour; @hasegawa2014dogs]. Twelve individual behaviors were chosen and coded (see Table \@ref(tab:indiv-behav-table) for definitions). All behaviors fell into two major categories of physiological stress: focused/attentive behavior, which can also be classified into the greater category of eustress, or distress.  

In BORIS, search stages were scored as start/stop during the timeline of the search. The individual behaviors were collected as both count data and amount of time the behaviors were displayed. Across the two trial dates, fifty-five videos were coded twice, once with each ethogram. The video was coded for the entire time the dog was fully visible within the video. There was one trained coder for each ethogram. Once the videos were coded, the two behavior types were paired statistically so that the appropriate individual behaviors fell within the relevant behavioral state according to video timing.

```{r indiv-behav-table, echo=FALSE, out.width="95%"}

##See if I can make this better

behav_names <- c("Jumping", "Look at Handler", "Pawing", "Sniffing", "Shoulder shrug", "Eye Convergence", "Facial Tensing", "Head Turn", "Lip Lick", "Ear Prick", "Head Snap", "Tail Wag")

behav_defs <- linebreak(c("The dogs jumps, suspending front paws in air\nor leaning on experimental wall", 
                          "Dogs looks at handler", 
                          "Paws any part of the wall or floor", 
                          "Nose near the wall and clear movement of nose\nto indicate sniffing",
                          "Tightening of chest and shoulders so that it\nappears as if the dog is shrugging", 
                          "Both eyes converged on a point on the wall or\nat the handler, indicating focused and intense\nstaring", 
                          "Tensing of the facial muscles", 
                          "Turning the head away from the wall and towards\nthe handler", 
                          "Clear tongue protrusion and lip licking", 
                          "Muscular modulation of ear to either perked up\nposition or pointed back", 
                          "Clear and quick snap of head back to original\nhead position", 
                          "Back and forth movement  of tail"), align = "l")

phys_state_grouping <- c("Distress", "Distress", "Distress", "Focused/Attentive", "Focused/Attentive", "Focused/Attentive", "Focused/Attentive", "Distress", "Distress", "Focused/Attentive", "Focused/Attentive", "Focused/Attentive")

behav_data <- data.frame(behav_names, behav_defs, phys_state_grouping)

kable(behav_data, "simple", col.names = c("Individual Behaviors", "Definitions", "States aligned with Behaviors"), align = "lll", caption = "Table of individual behaviors")

```


### Kinematic Analysis

Movements of dogs during the search were quantified using the tracking software DLTdv8 [@hedrick2008software]. Two points on the dogs' heads (the middle of the tip of the nose, in between the dogs' eyes) were digitized by hand in each frame of the two synced video views in DLTdv8. The two dimensional points from each video view were then used with easyWand calibration to calculate the three-dimensional position of each digitized point [@theriault2014protocol]. Three-dimensional points were then exported for further analysis using custom software in R version 4.3.1 [@Rcoreteam] (See data availability for location of code used for analyses). The same two coders for the behavioral analysis completed the kinematic analysis, with one coder acting as a confirmatory judge of the first coder’s analysis.

   
### Statistical analysis

Statistical analyses of search stage and behavior data was performed in R version 4.3.1 [@Rcoreteam]. Data for comparison were tested for normality with a Shapiro-Wilk test and for significance using Welch's t-test, Wilcoxon rank-sum test, or signed rank test, noted along with statistical values reported below. P-values were adjusted for multiple comparisons using a Bonferroni correction. 

To compare where the dogs concentrated their efforts during different types of behavior, a cluster comparison for two behavior types (casting and localizing) was performed. Clusters were identified with a k-means analysis using the k-means  function in base R. K-means clustering is a method that reduces the within cluster variance relative to the clusters’ mean for a specified number of groups [@Hartigan_Wong_1979]. K-means quantification requires the user to specify the number of clusters to be found. In this analysis a cluster would equate to a high density zone of a given behavior. For our experimental configuration this was set to five, one per odor hole and one additional for background/off-wall behavior. 

To evaluate the accuracy of this clustering scheme for each chemical relative to our expectation we then calculated the gap statistic of each cluster using the function `clusGap` from cluster package was then calculated [@clusterpkg]. The gap statistic summarized the distance of the pooled sum of the squares for a cluster relative to that data under a null distribution [@tibshirani_estimating_2001]. The higher the gap statistic, the more defined a cluster is. Gap statistics are often used to search for the optimal number of clusters in the system but here were used to compare the performance of a single clustering configuration for each target chemical to assess how centralized the behaviors of the dogs are in their search.

## References

