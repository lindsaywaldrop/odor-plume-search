---
title: "Physical properties of odorants affect behavior of trained detection dogs during close-quarters searches"
author: 
 - Daniel Mejia^1^, Lydia Burnett^2^, Nicholas Hebdon^1^, Peter Stevens^3^, Alexis Shiber^1^,
 - Clay Cranston^1^, Lauryn DeGreeff^2^, and Lindsay D. Waldrop^1^ 
date: "`r Sys.Date()`"
output: 
  bookdown::pdf_document2:
    number_sections: false
    toc: false
    keep_tex: yes
bibliography: references.bib
csl: scientific-reports.csl
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
knitr::opts_chunk$set(echo = TRUE, fig.width = 8)
options(knitr.graphics.error = FALSE)
```
 
 1. Schmid College of Science and Technology, Chapman University
 2. Global Forensic and Justice Center and Department of Chemistry and Biochemistry, Florida International University
 3. The Scentsable K9, El Cajon, CA

Corresponding author: L.D. Waldrop waldrop@chapman.edu
```{r results_code, include=FALSE}
# Loading required libraries
library(knitr)
library(tidyr)
library(kableExtra)
library(ggplot2)
library(patchwork)
library(viridis)
library(cluster)

# Loading required functions:
source("./src/kinematic_fxns.R")


#### Additional objects ####

hole_bump_x <- 0.01
hole_bump_z <- 0.06
chem_colors <- c("#F3C8C0", "#BC8DA6")
task_labs <- c("Off task", "Casting", "Localizing", "Alert")
state_behavior_labels <- c("Jumping", "Look at handler", "Pawing", "Sniffing")
point_behavior_labels <- c("Chest tightness", "Eye convergence", "Facial tensing",
                           "Head turn", "Lip lick", "Ear prick", "Head snap", 
                           "Tail wag")

#### Rerun full analysis ####

#To rerun kinematic track analysis, uncomment the following line: 
#source("./src/kinematics_paper_analysis.R")

# And change the date to today's date:
analysis_date <- "2023-12-21"

#### Load previous analysis ####

# Loads previously analyzed data:
tracks <- read.csv(paste0("./results/csv-files/kinematics-final-tracks_", analysis_date, 
                          ".csv"))
tracks$task <- factor(tracks$task, levels = c("t", "c", "o", "a"))
tracks<-tracks[tracks$trained == T,]

trial_holes <- read.csv(paste0("./results/csv-files/trial_holes_", analysis_date, 
                               ".csv"))
trial_holes$x <- trial_holes$x + hole_bump_x
trial_holes$z <- trial_holes$z + hole_bump_z

dog_mean_hot_dist <- read.csv(paste0("./results/csv-files/dog-mean-hot-dist_", 
                                     analysis_date, ".csv"))
dog_mean_hot_dist <- dog_mean_hot_dist[dog_mean_hot_dist$trained == T, ]

dog_mean_total_task_time <- read.csv(paste0("./results/csv-files/dog-mean-total-task-time_",
                                            analysis_date, ".csv"))
dog_mean_total_task_time$dog <- factor(dog_mean_total_task_time$dog)
dog_mean_total_task_time$chemical <- factor(dog_mean_total_task_time$chemical)
dog_mean_total_task_time$task <- factor(dog_mean_total_task_time$task, 
                                        levels = c("t", "c", "o", "a"))
dog_mean_total_task_time <- dog_mean_total_task_time[dog_mean_total_task_time$trained == T, ]

dog_mean_event_times <- read.csv(paste0("./results/csv-files/dog-mean-event-times_",
                                            analysis_date, ".csv"))
dog_mean_event_times <- dog_mean_event_times[dog_mean_event_times$trained == T, ]

dog_point_counts <-  read.csv(paste0("./results/csv-files/dog-point-counts_",
                                            analysis_date, ".csv"))
dog_point_counts <- dog_point_counts[dog_point_counts$trained == T, ]

alerts <-  read.csv("./data/alert_success.csv")
alerts$dog <- factor(alerts$dog)
alerts$chemical <- factor(alerts$chemical)

breed_data <- read.csv("./data/kinematics/dog_sizes.csv")
breed_data <- breed_data[-c(2, 5, 8, 17, 18, 20:27),] #removing dogs that are not a part of this study
breed_data <- breed_data[, -3]
breed_data <- breed_data[order(breed_data$dog, decreasing = F),]

```



```{r pe-calc, include=FALSE}
Da <- 0.0002403 # m2/s
De <- 0.0000663 # m2/s
Db <- 5.91e-6 # m2/s
Dm <- 7.11e-6 # m2/s
U <- 0.005 # m/s
L_long <- 10
L_cast <- 1
L_local <- 0.1
Pe_e_long <- (L_long*U)/(De)
Pe_a_long <- (L_long*U)/(Da)
Pe_b_long <- (L_long*U)/(Db)
Pe_m_long <- (L_long*U)/(Dm)
Pe_e_cast <- (L_cast*U)/(De)
Pe_a_cast <- (L_cast*U)/(Da)
Pe_b_cast <- (L_cast*U)/(Db)
Pe_m_cast <- (L_cast*U)/(Dm)
Pe_e_local <- (L_local*U)/(De)
Pe_a_local <- (L_local*U)/(Da)
Pe_b_local <- (L_local*U)/(Db)
Pe_m_local <- (L_local*U)/(Dm)
Pe <- data.frame("Description" = c("Far field", "Medium range", "Close quarters"),
                 "LengthL" = c(L_long, L_cast, L_local), 
                 "Pe2E1H" = c(Pe_e_long, Pe_e_cast, Pe_e_local),
                 "PeNH~3~" = c(Pe_a_long, round(Pe_a_cast), signif(Pe_a_local, 2)),
                 "Pebromooctane" = c(Pe_b_long, round(Pe_b_cast), signif(Pe_b_local, 2)),
                 "Pemethylbenz" = c(Pe_m_long, round(Pe_m_cast), signif(Pe_m_local, 2)))
```

<!-- 

Editing passes / finishing list:
 - edit for tense agreement
 - typo pass, grammar, reference number
 - make sure odor and odorant are used properly (Intro DONE)
 - make sure behavior, search stage, and movement are used properly (Intro DONE)
 
-->


## Abstract


Trained detection dogs have a unique ability to find the sources of target odors in complex fluid environments. How dogs derive information about the source of an odor from an odor plume comprised of odorants with different physical properties, such as diffusivity, is currently unknown. Two volatile chemicals associated with explosive detection, ammonia (NH~3~, derived from ammonium nitrate-based explosives) and 2-ethyl-1-hexanol (2E1H, associated with composition C4 plastic explosives) were used to ascertain the effects of the physical properties of odorants on the search behavior and motion of trained dogs. NH~3~ has a diffusivity 3.6 times that of 2E1H. Fourteen civilian detection dogs were recruited to train on each target odorant using controlled odor mimic permeation systems as training aids over six weeks and then tested in a controlled-environment search trial where behavior, motion, and search success were analyzed. Our results indicate the target-odorant influences search motion and time spent in the stages of searching, with dogs spending more time in larger areas while localizing NH~3~. This aligns with the greater diffusivity of NH~3~ driving diffusion-dominated odor transport when dogs are close to the odor source in contrast to the advection-driven transport of 2E1H at the same distances.

## Introduction

Dogs are trained to locate items of interest via the detection of chemical cues (odors), including contraband, firearms, explosives, disease, and humans [@furton2001scientific; @settles2005sniffers; @cablk2008olfaction; @boedeker2012sniffer; @wasser2012using;  @pemberton2013bloodhounds;  @narayanasamy2023hide]. Trained operational dogs are a key feature of many security and law enforcement programs, despite the cost and difficulty of selecting, training, and maintaining them [@leighton2018solution; @lazarowski2020selecting]. Technology of artificial sensors now rivals the sensitivity of a dog’s nose, yet dogs continue to out perform these sensors in their superior selectivity and their ability to interpret the complex fluid problem of locating a target odor's source [@furton2001scientific; @settles2005sniffers; @cablk2008olfaction; @eu2013olfactory; @reddy2022olfactory].

Dogs must search a spatially and temporally complex odor plume that is created by the interactions between an odor source and the environment [@murlis1992odor;  @settles2005sniffers; @young2020odors]. Odor enters the surrounding air from the source and is carried away via air currents [@elkinton1984odor; @young2020odors]. Air shearing across itself forms high-concentration filaments of odor in eddies, and molecular diffusion spreads odors between layers of air in eddies, softening the edges of the odor filaments [@koehl2001lobster; @young2020odors]. This mixing is incomplete, and as a result, an odor plume consists of patterns of high- and low-concentration filaments that vary in space and time [@koehl2001lobster]. Both environmental features, such as wind and objects in the area, and the physical properties of an odorant, such as diffusivity, can impact the distribution and concentration of odor filaments within the odor plume [@koehl2006; @young2020odors]. 

When a dog investigates a plume, it samples the plume by sniffing, or taking in discrete volumes of the air, immediately surrounding its nose [@Dethier:1987; @settles2005sniffers]. The signals that the dog encounters at the scale of its nose are intermittent; odor is contained in high-concentration filaments which the dog samples between low or no odor samples [@koehl2001lobster; @reddy2022olfactory]. Thus, odor information from a plume is complex in space and time and not a steady concentration gradient from start to source [@murlis1992odor; @settles2005sniffers; @young2020odors]. 

Through this sampling, dogs must derive enough information from a plume to find the source of an odor. Dogs and other animals use two sets of behaviors during a search to gather information from an intermittent odor plume: casting and localizing [@weissburg1994odor; @settles2005sniffers]. Casting is the appearance of zig-zagging in moths and crabs, constant turning in fish and birds, or head turning in mice and dogs [@farkas1972chemical; @murlis1992odor; @weissburg1994odor; @belanger1996adaptive; @hepper2005many; @settles2005sniffers; @prada2018birds]. Casting typically occurs far from the source and allows the animal to enter, exit, and re-enter the edges of the plume, acquiring information on the odor's source from the spatial and temporal patterns of signals as well as flow direction and speed [@farkas1972chemical; @weissburg1994odor; @belanger1996adaptive;  @porter2007mechanisms; @liu2020mouse]. Once very close to the source, these signals become less reliable and animals switch to localizing behaviors to determine the exact position of the odor source [@weissburg1994odor; @Ache:2005; @gire2016mice; @reddy2022olfactory]. 

The shape of the plume depends on advection and diffusion, which can influence the way odor moves local to the source. Whereas vapor pressure of odorants largely determines the mass of that odorant that enters the surrounding air, molecular diffusion determines how much that mass spreads out in the air. The P\'{e}clet number describes the ratio between advection and diffusion in odor transport: $Pe = UL/D$, where $U$ is the external flow speed, $L$ is a characteristic length, and $D$ is the diffusion coefficient of the odorant. When considering transport of odor far from the source ($L$ is large), the $Pe$ is much greater than one, indicating that bulk air movement is the primary mode of transport and differences in diffusivity have little importance. However, when considering close-quarters searching, characteristic lengths would be much smaller. Here, even moderate differences in diffusivity between odorants can drive $Pe$ close to one, indicating the relative importance of diffusion-driven transport to the plume (Table \@ref(tab:pe-table)).

We know that environmental processes that affect advection can produce effects in search behavior and success in dogs that engage in long-distance searching [@cablk2008olfaction; @ruzicka2012does; @jinn2020ambient], but there have been fewer studies investigating how an odor's physical properties may impact close-quarters searches. Many operational dogs engage in close-quarters searching for contraband and explosives in rooms or enclosed spaces or items, such as vehicles, packages, or luggage, where the dog begins its search relatively close to the odor source. While odors of different physical properties can also affect search success of narcotics and explosive detection dogs [@furton2001scientific], there has been no study on how these differences might affect the behavior and movement of dogs during the casting and localizing stages of active searches. Since these types of searches can have $Pe \approx 1$, it is possible that odors of different diffusivities could impact the way dogs search and their success in close quarters.

To investigate how the physical properties of odors can impact close-quarters searching and search success, we observed the unrestricted search behavior of trained dogs in a standardized search environment with one of two target odorants: ammonia (NH~3~) and 2-ethyl-1-hexanol (2E1H). These chemicals are important for detection of explosives, as they are the dominant odorants in the headspace of two common explosives ((NH~3~) is a degradant of ammonium nitrate and 2E1H is associated with the plasticizers used in the plastic explosive, C4) [@southwest1973narcotic; @furton2001scientific;  @katilie2019quantitative; @gazit2021dogs; @degreeff2021headspace; @frank2022explosives]. NH~3~'s diffusion coefficient is 3.6 times that of 2E1H (Table \@ref(tab:pe-table)) [@spiller1989determination; @guard1999chemical; @wakayama2019comprehensive].

We expected the behavior and motion of the dogs would differ between the two target odorants due to their physical properties, with movement distributed more widely during localizing NH~3~, where $Pe \approx 1$. We also predicted that behaviors associated with stress, such as lip licking, as well as more spread movements would occurring searches for NH~3~ than 2E1H due to the much wider, more diffuse plume produced by NH~3~.

```{r pe-table, echo=FALSE}
kable(Pe, "simple", col.names = c("", "Length, $L$ (m)", "$Pe$ 2E1H", 
                                  "$Pe$ NH$_3$", "$Pe$ bromooctane", "$Pe$ methyl benzoate"), 
             align = "c", digits = c(0, 1, 0, 1, 0, 0), row.names = F,
      caption="Estimated Péclet numbers ($Pe$) for different length scales where the flow speed ($U$) is 0.5 cm s^-1^ and the diffusion coefficients ($D$) are 0.0663 (2E1H), 0.2403 (NH~3~), 0.0591 (bromooctane), and 0.0711 (methyl benzoate) cm^2^ s^-1^.")
```



## Methods

### Materials 

Ammonium hydroxide (Sigma-Aldrich) and 2-etyhyl-1-hexanol (Sigma-Aldrich) were selected as the two target odorants of interest due to differences in their physical properties (Table \@ref(tab:pe-table); SI Table 1). In order to train the dogs to search the two different target odors, handlers were given controlled odor mimic permeation systems (COMPS) as training aids. COMPS are a tool that controls odor availability during training. For this study, each COMPS consists of 20 $\mu$L of analyte pipetted onto a 2 inch by 2 inch piece of cotton-blend gauze pad (Dukal, LLC) which was heat-sealed in a 2 by 3 inch plastic bag. The analyte is released at a rate determined by the thickness and surface area of the bag [@simon2019]. Since NH~3~ has a much higher vapor pressure than 2E1H, it was necessary to equalize the amount of each chemical presented to the dog during training and the experimental trial. In order to accomplish this, a 3 MIL low density polyethylene bag (LDPE; Uline) was used for 2E1H and a 8 MIL LDPE bag (Uline) was used for NH~3~. Non-target or distractor odorants were prepared in a similar way for methyl benzoate (Sigma-Aldrich; 3 MIL bag) and bromooctane (Sigma-Aldrich; 8 MIL bag).


### Participants 


Fourteen civilian dogs were recruited through the National Association of Canine Scent Work (NACSW\textsuperscript{TM}). NACSW dogs train to detect essential oils for competition. Dogs recruited had achieved NACSW Nose Work 3 title or higher. Dogs at this level are trained to detect multiple odor sources, trials with blanks, and in various search situations. Three small dogs (dogs $< 30$ lbs; mean body weight `r round(mean(breed_data$weight[breed_data$weight < 30]), digits = 1)` lbs) and eleven large dogs (dogs $\geq 30$ lbs; mean body weight `r round(mean(breed_data$weight[breed_data$weight >= 30]), digits = 1)` lbs) were included of various breeds (SI Table 2). The handlers were not compensated for participation. During the training period, handlers were given COMPS training aids containing either 2E1H, NH~3~, or a blank aid with gauze sealed in a bag and no analyte. Trainers logged the time in which they used each COMPS and were instructed to throw away the COMPS and open a new one after it was exposed to the air for a total of six hours. Handler-dog teams were given six weeks to train with the COMPS before participating in the trial. Each handler-dog team trained off-site and individually as they would for typical nose work odor competitions.

### Animal Use Ethics Statement

All experimental procedures in this study were approved by the Institutional Animal Care and Use Committee at Florida International University (FIU IACUC protocol \#201314). The study observed all federal, state, and local regulations on the use of vertebrate animals in research. All appropriate permissions from institutions and trial locations were obtained to use dogs in research for this study.


### Experimental Setup and Procedure

The trial was held in Huntington Beach, California in February, 2023 at a dog training facility. Two plywood trial walls were set up in the middle of facility (SI Figure 1). The walls consisted of three four-foot-by-four-foot panels of half-inch thick plywood with two inch-by-three-inch studs that were connected in a C pattern. The center panel contained four imprinting holes (three-inch interior, four-inch exterior ABS toilet flange; OATEY) located at a distance on center from the bottom of the wall. In each of the four flanges, a three-inch white cap was secured in each opening, holding a sensor. Each hole appeared identical to both the dogs and human observers. Two experimental walls were used corresponding to the size of the dogs in the study with the only difference being the distance of the imprinting holes from the bottom of the wall: 16 inches (0.406 m) for large dogs and 10 inches (0.254 m) for small dogs (SI Fig. 1).

Each hole presented a single odorant to the dogs through a small opening on a plastic PVC cap (SI Fig. 1). Behind the wall and not visible to the dogs, the interior side of the flanges each had a white PVC pipe extending horizontally from the face of the wall. One COMPS was placed in three of the four holes, containing one of two distracting odorants (either methyl benzoate or bromooctane) or one of the two target odorants (either 2E1H or NH~3~). A fourth hole had no odor (blank). For additional details, see supplementary information.

COMPS were placed in the imprinting devices five to ten minutes before dogs were allowed to interact with the wall. The dogs were then run in no specific order. Once one dog left the experimental area, another dog-handler dyad was brought into the area. No special effort was made to reset or control the odor plume from the wall and the area was not cleaned between dogs. All dogs were first run with 2E1H and then NH~3~. After each run with a target odor, distracting-odor COMPS were replaced. The white, PVC cap and ABS imprinting hole were replaced between 2E1H and NH~3~ runs to limit cross-contamination between target odors. A 15- to 20-minute period between runs with each target odor was given to allow the previous odor plumes to dissipate.

During a run, each dog was allowed to first search a similar imprinting wall with a nose work odor source immediately before each experimental run. Two observers remained behind the dog-handler dyad to note observations and to coach the handler, if needed. The handlers were blind to which hole contained the target odor. Dogs were allowed to freely move about the face and sides of the wall during the search while remaining on long leash. Dogs then approached the wall to search until either a trained final response was called by the handler or the handler determined the dog was not likely to find the target source. Once the dog had searched the experimental wall, the dog was given a second opportunity to search the wall containing a nose work odor source and then the team exited the facility. To assess whether the dogs were more successful at locating one odor or another, the successful versus unsuccessful alerts were noted by both observers during each run.


### Kinematic Analysis

Two video cameras (GoPro Hero 8 Black, GoPro, San Mateo, CA) were placed in view of the front of the wall where dogs interacted with odors, one above the holes and one to the right side of the trial wall, resulting in a top view and side view, respectively (SI Fig. 2). Calibration footage was taken each time the cameras were initially set up or moved. For additional details, see supplementary information. Movements of dogs during the search were quantified using the tracking software DLTdv8 [@hedrick2008software]. Two points on the dogs' heads (the middle of the tip of the nose, in between the dogs' eyes) were digitized by hand in each frame of the two synced video views in DLTdv8. Ten calibration points were also digitized per run. The two dimensional points from each video view were then used with easyWand calibration to calculate the three-dimensional position of each digitized point [@theriault2014protocol]. Three-dimensional points were then exported for further analysis using custom software in R version 4.3.1 [@Rcoreteam] (see data availability for location of code used for analyses). The three-dimensional kinematic points were then realigned with the trial wall's face through the use of calibration points such that the bottom center of the ABS imprinting holes represented 0 on the vertical axis, aligning the kinematic track points from the small and large dog walls. The same two coders for the behavioral analysis completed the kinematic analysis, with one coder acting as a confirmatory judge of the first coder's analysis. 


### Behavioral Analysis

To analyze the behaviors occurring along the search path, two ethograms were created to code behavioral stages related to searching and other, relevant individual behaviors that occurred during the search. Each ethogram was created and coded using the Behavioral Observation Research Interactive Software (BORIS)[@friard2016boris]. Behavior states and individual behaviors were scored by two trained observers (one for behavior states, one for individual behaviors). 

Using a combination of classical and operant conditioning, dogs are trained to behave a certain way once they have detected a target odor and are close to the source of that odor. The use of a detection dog and location of one or more of the target odors will typically go as follows: (1) The dog is deployed with a search command. (2)  Casting stage: the dog will start sampling the air currents trying to locate an odor plume.  As air current carries the target odor, dogs locate the edges of the odor plume and try to find the source. The dog will move its head from side to side trying to locate the edges of the odor plume and the odor source. (3)  Localizing stage: once the dog has detected the odor plume, it engages in noticeable changes of behavior. The dog often becomes visibly excited with its body becoming more rigid, changes in rates of breathing, and appear more focused. The dog will close its mouth, very focused sniffing occurs, and sniffing frequency increases. Sometimes the dog will appear to become frantic or engage in a sudden turn of the head. (4)  Alert phase: after the dog has successfully located the source of the odor, the dog has been conditioned to perform a specific behavior, often called a trained final response. The most common trained final responses in professional detection work is a sit or freeze and in civilian sport detection is a head turn and look at the handler. The dog is then rewarded with a reinforcer (e.g., food or toy). 

Behavioral stages were defined stages that correspond to the search stages explained above: casting, localizing, and alerting. An off-task stage was also added for times where the dog was not engaged in the search task, and any off-task behavior was removed from all analyses. Current literature defines three search phases in dogs (i.e., Thesen et al.[@thesen1993behaviour]: initial, deciding, and tracking phases), where each phase differs from the other based on speed, sniff frequency, and time spent sniffing. The addition and use of distinct casting and localizing stages in this study bridges the gap in terminology from tracking and trailing to the wider olfactory literature [@weissburg1994odor; @settles2005sniffers; @belanger1996adaptive; @hepper2005many; @farkas1972chemical; @prada2018birds; @murlis1992odor; @gire2016mice; @reddy2022olfactory].

Individual behaviors were defined as distinct behaviors displayed independently of search stage and collected as both the number of incidents and amount of time the behaviors were displayed. The behaviors were selected after observations made during the trials and because they have been linked with psychological and physiological states of being, such as confusion, avoidance, anxiousness, focus, and alertness [@bodnariu2008indicators; @melco2020investigation; @thesen1993behaviour]. Twelve individual behaviors were chosen and coded (see SI Table 3 for definitions). All behaviors fell into two major categories of physiological stress: focused/attentive behavior, which can also be classified into the greater category of eustress or distress. In BORIS, search stages were scored as start/stop during the timeline of the search. The individual behaviors were collected as both count data and amount of time the behaviors were displayed. Across the two trial dates, fifty-five videos were coded twice, once with each ethogram. The video was coded for the entire time the dog was fully visible within the video. There was one trained coder for each ethogram. Once the videos were coded, the two behavior types were paired statistically so that the appropriate individual behaviors fell within the relevant behavioral state according to video timing.

   
### Statistical analysis

Statistical analysis of search stage and behavior data was performed in R version 4.3.1 [@Rcoreteam]. Three-dimensional distances of each dog's nose to the target odor hole were taken from the kinematic data during search and categorized based on the behavior stage on the ethogram. Total times in each behavior state were calculated based on the number of video frames between start and stop codes. Data for comparison were tested for normality with a Shapiro-Wilk test and for significance using Welch's t-test, Wilcoxon rank-sum test, or signed rank test, noted along with statistical values reported below. P-values were adjusted for multiple comparisons using a Bonferroni correction. To compare where the dogs concentrated their efforts during search stages, a cluster comparison for two behavior types (casting and localizing) was performed. Clusters were identified with a k-means analysis using the k-means function in base R. K-means clustering is a method that reduces the within cluster variance relative to the clusters’ mean for a user-specified number of groups [@Hartigan_Wong_1979]. In this analysis, a cluster would equate to a high-density zone of a given behavior. For our experimental configuration this was set to five, one per odor hole and one additional for background/off-wall behavior. To evaluate the accuracy of this clustering scheme for each chemical relative to our expectation we then calculated the gap statistic of each cluster using the function clusGap from cluster package was then calculated [@clusterpkg]. The gap statistic summarized the distance of the pooled sum of the squares for a cluster relative to that data under a null distribution [@tibshirani_estimating_2001]. For additional details, see supplementary information.


## Results

### Target odor affects search patterns of dogs


```{r k-mean-calcs, include=FALSE}
# K means clustering analysis
set.seed(15)
scaled_tracks <- na.omit(tracks[tracks$point == "nose", c("x","y","z","task","run")])
scaled_tracks$x <- (scaled_tracks$x - min(scaled_tracks$x))/(max(scaled_tracks$x)-min(scaled_tracks$x))
scaled_tracks$y <- (scaled_tracks$y - min(scaled_tracks$y))/(max(scaled_tracks$y)-min(scaled_tracks$y))
scaled_tracks$z <- (scaled_tracks$z - min(scaled_tracks$z))/(max(scaled_tracks$z)-min(scaled_tracks$z))

cluster_2E1H_casting <- calc_kmeans(scaled_tracks, 1, "c", 5)
cluster_2E1H_detailing <- calc_kmeans(scaled_tracks, 1, "o", 5)
cluster_Amm_casting <- calc_kmeans(scaled_tracks, 2, "c", 5)
cluster_Amm_detailing <- calc_kmeans(scaled_tracks, 2, "o", 5)

```

```{r data-setup-density-plots, include=FALSE}
dat_2E1H_casting <- na.omit(tracks[tracks$point == "nose" & tracks$run == 1 & 
                                     tracks$task == "c",])
dat_2E1H_casting$cluster <- factor(cluster_2E1H_casting$cluster_points)

dat_2E1H_detailing <- na.omit(tracks[tracks$point == "nose" & tracks$run == 1 & 
                                       tracks$task == "o",])
dat_2E1H_detailing$cluster <- factor(cluster_2E1H_detailing$cluster_points)

dat_Amm_casting <- na.omit(tracks[tracks$point == "nose" & tracks$run == 2 & 
                                    tracks$task == "c",])
dat_Amm_casting$cluster <- factor(cluster_Amm_casting$cluster_points)

dat_Amm_detailing <- na.omit(tracks[tracks$point == "nose" & tracks$run == 2 & 
                                      tracks$task == "o",])
dat_Amm_detailing$cluster <- factor(cluster_Amm_detailing$cluster_points)
```


```{r stats-calc, include=FALSE}

#testing distance from source for both odors in each pattern
dog_mean_hot_dist$value <- dog_mean_hot_dist$hot_dist
anova_dist_test <- anova(lm(value~chemical*task, data = dog_mean_hot_dist))
casting_dist_test <- t_test_sniff(dog_mean_hot_dist, "c", 4)
detailing_dist_test <- t_test_sniff(dog_mean_hot_dist, "o", 4)

# manually testing distance in casting vs detailing for ammonia
amm_sniff_c <- dog_mean_hot_dist$value[dog_mean_hot_dist$task == "c" & 
                                         dog_mean_hot_dist$chemical == "Ammonia"]
shapiro.test(amm_sniff_c)
amm_sniff_o <- dog_mean_hot_dist$value[dog_mean_hot_dist$task == "o" & 
                                         dog_mean_hot_dist$chemical == "Ammonia"]
shapiro.test(amm_sniff_o)
chemical_amm_dist_test <- t.test(amm_sniff_c, amm_sniff_o)
chemical_amm_dist_test$p.value <- p.adjust(chemical_amm_dist_test$p.value, 
                                           method = "bonferroni", n = 4)

# manually testing distance in casting vs detailing for 2E1H
eh_sniff_c <- dog_mean_hot_dist$value[dog_mean_hot_dist$task == "c" & 
                                         dog_mean_hot_dist$chemical == "2E1H"]
shapiro.test(eh_sniff_c)
eh_sniff_o <- dog_mean_hot_dist$value[dog_mean_hot_dist$task == "o" & 
                                         dog_mean_hot_dist$chemical == "2E1H"]
shapiro.test(eh_sniff_o)
chemical_2E1H_dist_test <- t.test(eh_sniff_c, eh_sniff_o)
chemical_2E1H_dist_test$p.value <- p.adjust(chemical_2E1H_dist_test$p.value, 
                                           method = "bonferroni", n = 4)

# Mean time spent in casting or detailing b/w chemicals
casting_tasktime_test <- t_test_sniff(dog_mean_total_task_time, "c", 4)
detailing_tasktime_test <- t_test_sniff(dog_mean_total_task_time, "o", 4)
anova_tasktime_test <- anova(lm(value ~ chemical * task, 
                                data = dog_mean_total_task_time))


# Testing total time in casting versus detailing for 2E1H (significant)
eh_cast_time <- dog_mean_total_task_time$value[dog_mean_total_task_time$task =="c" &
                                                   dog_mean_total_task_time$chemical == "2E1H"]
eh_detail_time <- dog_mean_total_task_time$value[dog_mean_total_task_time$task =="o" &
                                                   dog_mean_total_task_time$chemical == "2E1H"]
eh_cast_detail_test <- t.test(eh_cast_time, eh_detail_time)
eh_cast_detail_test$p.value <- p.adjust(eh_cast_detail_test$p.value,
                                           method = "bonferroni", n = 2)

# Testing total time in casting versus detailing for Ammonia (not significant)
am_cast_time <- dog_mean_total_task_time$value[dog_mean_total_task_time$task =="c" &
                                                   dog_mean_total_task_time$chemical == "Ammonia"]
am_detail_time <- dog_mean_total_task_time$value[dog_mean_total_task_time$task =="o" &
                                                   dog_mean_total_task_time$chemical == "Ammonia"]
am_cast_detail_test <- wilcox.test(am_cast_time, am_detail_time)
am_cast_detail_test$p.value <- p.adjust(am_cast_detail_test$p.value,
                                           method = "bonferroni", n = 2)

# Testing 2E1H versus Ammonia for each state behavior
look_eventtime_test <- t_test_sniff(dog_mean_event_times, "l", 4)
sniff_eventtime_test <- t_test_sniff(dog_mean_event_times, "s", 4)
jump_eventtime_test <- t_test_sniff(dog_mean_event_times, "j", 4)
paw_eventtime_test <- t_test_sniff(dog_mean_event_times, "p", 4)

anv_task_chem_dog_times <- anova(lm(value ~ task * chemical, 
                                    data = dog_mean_event_times))

# Testing 2E1H versus Ammonia for point behavior
hturn_point_test <- t_test_sniff(na.omit(dog_point_counts), "h", 8)


# Setting up matrix for fisher's exact test on alerts
e_alerts_true <- sum(alerts$success[alerts$chemical=="2E1H"] == TRUE)
e_alerts_false <- sum(alerts$success[alerts$chemical=="2E1H"] == FALSE)
a_alerts_true <- sum(alerts$success[alerts$chemical=="Ammonia"] == TRUE)
a_alerts_false <- sum(alerts$success[alerts$chemical=="Ammonia"] == FALSE)

##alert test to see difference between success counts for two chemicals
alert_mat <- matrix(c(e_alerts_true, e_alerts_false, a_alerts_true, a_alerts_false), 
                    byrow = T, nrow = 2)
alert_test <- fisher.test(alert_mat)


total_search_times <- data.frame("dog" = rep(NA, 28), 
                                 "chemical" = rep(NA, 28),
                                 "success" = rep(NA, 28),
                                 "value" = rep(NA, 28))
counter <- 0
for(i in 1:nlevels(dog_mean_total_task_time$dog)){
  for(j in 1:nlevels(dog_mean_total_task_time$chemical)){
    counter <- counter + 1
    total_search_times$dog[counter] <- levels(dog_mean_total_task_time$dog)[i]
    total_search_times$chemical[counter] <- levels(dog_mean_total_task_time$chemical)[j]
    task_sub <- dog_mean_total_task_time[dog_mean_total_task_time$dog ==
                                           levels(dog_mean_total_task_time$dog)[i] &
                                           dog_mean_total_task_time$chemical == 
                                           levels(dog_mean_total_task_time$chemical)[j], 
                                         ]
    total_search_times$value[counter] <- sum(task_sub$value) - 
      task_sub$value[task_sub$task == "t"]
    total_search_times$success[counter] <- alerts$success[ 
      alerts$dog == levels(dog_mean_total_task_time$dog)[i] & 
        alerts$chemical == levels(dog_mean_total_task_time$chemical)[j]]
  }
}

#Difference b/w overall search times (non-sig)
E_search_time <- total_search_times$value[total_search_times$chemical == "2E1H"]
A_search_time <- total_search_times$value[total_search_times$chemical == "Ammonia"]
total_search_test <- t.test(E_search_time, A_search_time)


```

<!--
```{r sidewall-casting, fig.cap="Point-density plots (A and B) and k-means clustering plots (C and D) of the side view of trial wall during casting stage for 2E1H (A, C) and NH~3~ (B, D). Location of imprinting source holes marked with red circles (all chemicals are at same elevation).", echo=FALSE, warning=FALSE}

#(p2E1H_casting_density + pAmm_casting_density + plot_layout( guides = "collect")) /( p2E1H_casting_cluster + pAmm_casting_cluster + plot_layout( guides = "collect")) + 
#  plot_annotation(tag_levels = "A") 

```
-->

```{r frontwall-casting, fig.cap="Point-density plots (a and b) and k-means clustering plots (c and d) of the front view of trial wall during casting stage for 2E1H (a, c) and NH~3~ (b, d). Location of imprinting source holes marked with colored circles (red indicates location of target odorant, dark orange are distractors, gray is blank).",echo=FALSE, warning=FALSE}

p2E1H_casting_density <- point_density_plot(dat_2E1H_casting, trial_holes,
                                           "x", "z", 
                                           10, "2E1H","2E1H")
pAmm_casting_density <- point_density_plot(dat_Amm_casting, trial_holes,
                                           "x", "z", 
                                           10,"NH3",
                                           bquote(NH[3]))


p2E1H_casting_cluster <- cluster_plot(dat_2E1H_casting, trial_holes, 
                                      "x", "z", 
                                      "2E1H")

pAmm_casting_cluster <- cluster_plot(dat_Amm_casting, trial_holes, 
                                     "x", "z", 
                                     "NH3")

  
( p2E1H_casting_density + pAmm_casting_density ) /
  ( p2E1H_casting_cluster + pAmm_casting_cluster ) +
  plot_annotation(tag_levels = "a") + 
  theme(plot.tag = element_text(face = 'bold'), axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0))) +
  plot_layout(guides = "collect")


```


The casting stage describes the active search of a dog at the edge of a plume before it begins localizing to narrow down the search field to the odor source. It often involves larger movements and more changes of direction in order to cover a larger area and encounter infrequent odor signals. During casting, dogs approached the wall and worked between 0.2 and 1.0 m away from the wall. Fig. \@ref(fig:frontwall-casting) show the density maps of casting across all runs for both target odors. The distances of the dogs' noses to the target odor source differed significantly (Fig. \@ref(fig:hole-times)a, means: $`r round(casting_dist_test[["estimate"]][2], digits = 3)`$ m and $`r round(casting_dist_test[["estimate"]][1], digits = 3)`$ m for 2E1H and NH~3~, respectively; $t = `r round(casting_dist_test[["statistic"]], digits = 3)`$; $P = `r signif(casting_dist_test[["p.value"]], digits = 3)`$). The time spent engaging in casting, however, did not differ. Casting occurred further from the face of the wall and spread across the face of the wall (Fig. \@ref(fig:frontwall-casting)). K-mean gap scores for clusters were overall low for both 2E1H (`r round(cluster_2E1H_casting$cluster_data$gap, digits = 2)`) and NH~3~ (`r round(cluster_Amm_casting$cluster_data$gap, digits = 2)`). 

```{r hole-times, echo=FALSE, fig.width = 6.5, fig.height = 4.25, fig.cap="Mean distance the dogs occupied in the casting and localizing stages of search (a) as well as the mean time they spent within 10 cm of the source of each chemical (b). Single black filled circles represent outliers to the box plot. Sample size is noted along the bottom line if other than n = 14. * represents a comparison where the p < 0.05."}

p1 <- ggplot(dog_mean_hot_dist[dog_mean_hot_dist$task == "c" | dog_mean_hot_dist$task == "o",], aes(task, value, fill = chemical)) + 
  geom_boxplot(outlier.shape = NA) +
  geom_point(position = position_jitterdodge(jitter.width = 0.2), pch = 21, alpha = 0.4) +
  annotate(geom = "text", x = 0.60, y = 0.0, label = "n = ",  size = 3) +
  #annotate(geom = "text", x = 0.85, y = 0.0, label = "14",  size = 3) +
  annotate(geom = "text", x = 1.15, y = 0.0, label = "13",  size = 3) +
  annotate(geom = "text", x = 1.85, y = 0.0, label = "11",  size = 3) +
  annotate(geom = "text", x = 2.15, y = 0.0, label = "13",  size = 3) +
  scale_fill_manual(values = c(chem_colors[1], chem_colors[2]), name = "Target odor",
                    labels = c("2E1H", bquote(NH[3]))) +
  annotate(geom = "text", x = 1.7, y = 1.08, label = "*",  size = 6) +
  annotate(geom = "line", x = c(1.15, 2.25), y = c(1.03, 1.03),  linewidth = 1) +
  annotate(geom = "text", x = 1, y = 1.15, label = "*",  size = 6) + 
  annotate(geom = "line", x = c(0.75, 1.25), y = c(1.1,1.1), linewidth = 1) +
  scale_x_discrete(labels = c("Casting", "Localizing")) +
  ylab("Mean distance from target\nodor source (m)") + xlab(" ") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        legend.position="bottom")

p2 <- ggplot(dog_mean_total_task_time, aes(task, value, fill = chemical)) +
  geom_boxplot(outlier.shape = NA) + 
  geom_point(position = position_jitterdodge(jitter.width = 0.2), pch = 21, alpha = 0.4) +
  annotate(geom = "text", x = 0.75, y = -3.5, label = "n = ",  size = 3) +
  annotate(geom = "text", x = 2.75, y = -3.5, label = "13",  size = 3) +
  annotate(geom = "text", x = 3.75, y = -3.5, label = "5",  size = 3) +
  annotate(geom = "text", x = 4.25, y = -3.5, label = "11",  size = 3) +
  scale_fill_manual(values = c(chem_colors[1], chem_colors[2]), name = "Target odor", 
                    guide = "none") +
  scale_x_discrete(labels = task_labs) +
  annotate(geom = "text", x = 3, y = 18, label = "*",  size = 6) +
  annotate(geom = "line", x = c(2.75, 3.25), y = c(17, 17),  linewidth = 1) +
  annotate(geom = "text", x = 2.25, y = 26, label = "*",  size = 6) +
  annotate(geom = "line", x = c(1.75, 2.75), y = c(25, 25),  linewidth = 1) +
  ylim(-5, 60) + 
  ylab("Mean time spent in\nbehavioral state (s)") + xlab(" ") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        legend.position="bottom")

layout <- "
AAABBBBB
##CC####
"

p1 + p2 + guide_area() + plot_annotation(tag_levels = "a") + 
  plot_layout(guides = "collect", heights = c(4, 0.01), design = layout) & 
  theme(legend.position='bottom', plot.tag = element_text(face = 'bold'))
```


<!--

```{r sidewall-detailing, fig.cap="Point-density plots (A and B) and k-means clustering plots (C and D) of the side view of trial wall during localizing stage for 2E1H (A, C) and NH~3~ (B, D). Location of imprinting source holes marked with red circles (all chemicals are at same elevation).", echo=FALSE, warning=FALSE}

#( p2E1H_detailing_density + pAmm_detailing_density + plot_layout(guides = "collect")) /
#  ( p2E1H_detailing_cluster + pAmm_detailing_cluster + plot_layout(guides = "collect")) + 
#  plot_annotation(tag_levels = "A") 

```
-->

```{r frontwall-detailing, fig.cap="Point-density plots (a and b) and k-means clustering plots (c and d) of the front view of trial wall during localizing stage for 2E1H (a, c) and NH~3~ (b, d). Location of imprinting source holes marked with colored circles (red indicates location of target odorant, dark orange are distractors, gray is blank).", echo=FALSE, warning=FALSE}

p2E1H_detailing_density <- point_density_plot(dat_2E1H_detailing, trial_holes, 
                                              "x", "z", 
                                              10, "2E1H", "2E1H")

pAmm_detailing_density <- point_density_plot(dat_Amm_detailing, trial_holes, 
                                           "x", "z", 
                                           10,"NH3",
                                           bquote(NH[3]))

p2E1H_detailing_cluster <- cluster_plot(dat_2E1H_detailing, trial_holes, 
                                        "x", "z",
                                        "2E1H") 

pAmm_detailing_cluster <- cluster_plot(dat_Amm_detailing, trial_holes, 
                                       "x", "z",
                                       "NH3") 

( p2E1H_detailing_density + pAmm_detailing_density ) /
  ( p2E1H_detailing_cluster + pAmm_detailing_cluster ) + 
  plot_annotation(tag_levels = "a") + 
  theme(plot.tag = element_text(face = 'bold'), axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0))) +
  plot_layout(guides = "collect")

```

Localizing describes the behavior in which a dog searches a smaller area to narrow down the position of the odor source. This smaller search area is reflected in the localizing point density of 2E1H (Fig. \@ref(fig:frontwall-detailing)a,b), with the searching highly localized to the holes of the wall and little deviation from the wall's face. Clustering is highly robust and four of the groups correspond to the four source holes of the wall (Fig. \@ref(fig:frontwall-detailing)c,d; gap scores of `r round(cluster_2E1H_detailing$cluster_data$gap, digits=3)`). In contrast, NH~3~ localizing, while close to the surface of the wall, was spread both above and below the holes, showing clusters that were less distinct and not associated with individual holes (gap scores: `r round(cluster_Amm_detailing$cluster_data$gap, digits=3)`). Dogs were closer to the target source during localizing NH~3~ (Fig. \@ref(fig:hole-times)a) compared to 2E1H (Welch Two Sample t-test; means: $`r round(detailing_dist_test[["estimate"]][2], digits = 3)`$ m and $`r round(detailing_dist_test[["estimate"]][1], digits = 3)`$ m away from the wall for NH~3~ and 2E1H, respectively; $t = `r round(detailing_dist_test[["statistic"]], digits = 3)`$; $P = `r signif(detailing_dist_test[["p.value"]], digits = 3)`$). For NH~3~,the dogs had the highest density of movement near the odor source, whereas they searched the entire wall tightly for 2E1H (Fig. \@ref(fig:frontwall-detailing)a,b). There was a slightly higher density on the opposite end of the wall from the 2E1H odor source, yet they dogs still searched more tightly around all the holes than for NH~3~ (Fig. \@ref(fig:frontwall-detailing)a,b). Dogs also spent a longer time engaged in localizing for NH~3~ than 2E1H (Fig. \@ref(fig:hole-times)b) (Welch Two Sample t-test; means: $`r round(detailing_tasktime_test[["estimate"]][2], digits = 2)`$ s, $`r round(detailing_tasktime_test[["estimate"]][1], digits = 2)`$ s, $P = `r round(detailing_tasktime_test[["p.value"]], digits = 3)`$). With this, the time dogs engaged in casting as opposed to localizing NH~3~ did not differ (Wilcoxon rank sum exact test, $W = `r am_cast_detail_test$statistic`$, $P = `r round(am_cast_detail_test$p.value, digits = 3)`$), yet the dogs spent significantly less time localizing 2E1H than casting for it (Welch Two Sample t-test; means: $`r round(eh_cast_detail_test[["estimate"]][2], digits = 2)`$ s, $`r round(eh_cast_detail_test[["estimate"]][1], digits = 2)`$ s, $P = `r signif(eh_cast_detail_test$p.value, digits = 1)`$). 



### Dog behavior during search does not change with target odorant


```{r indiv-behavior-times, echo=FALSE, fig.width = 6.5, fig.height = 4.25, fig.cap="Mean time spent showing each of four behaviors (a) and the number of times the dogs displayed each of eight other behaviors (b). __There were no significant difference in any pairwise comparisons.__"}

p1 <- ggplot(na.omit(dog_mean_event_times), aes(x=task, y=value, 
                                           fill = chemical)) +
  geom_boxplot(outlier.shape = NA) +
  geom_point(position = position_jitterdodge(jitter.width = 0.4), pch = 21, alpha = 0.4) +
  geom_hline(yintercept = 0, alpha = 0.4) + 
  scale_x_discrete(labels = state_behavior_labels) +
  scale_fill_manual(values = c(chem_colors[1], chem_colors[2]), name = "Target odor",
                    labels = c("2E1H", bquote(NH[3]))) +
  xlab(" ") + 
  ylab("Time spent engaged\nin behavior (s)") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

p2 <- ggplot(na.omit(dog_point_counts), aes(x = task, y = value, fill = chemical)) + 
  geom_boxplot(outlier.shape = NA) +
  geom_point(position = position_jitterdodge(jitter.width = 0.2), pch = 21, alpha = 0.4) +
  scale_x_discrete(labels = point_behavior_labels) +
  scale_fill_manual(values = c(chem_colors[1], chem_colors[2]), name = "Target odor",
                    labels = c("2E1H", bquote(NH[3]))) +
  xlab(" ") + 
  ylab("Number of\ntimes observed") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

layout <- "
AAABBBBBB
###CC####
"
p1 + p2 + guide_area()  + plot_annotation(tag_levels = "a") +
  plot_layout(guides = "collect", heights = c(4, 0.1), design = layout) & 
  theme(legend.position='bottom', plot.tag = element_text(face = 'bold'))

```

When looking at both the counts and time spent displaying twelve behaviors associated with searching, focus, stress, and alerts, no significant differences were found between the two target odors. In Fig. \@ref(fig:indiv-behavior-times)a, the times the dogs spend displaying four state behaviors was not found to be statistically different based on the target odor  (Two-Way ANOVA, DFs = $`r anv_task_chem_dog_times[["Df"]][2]`, `r anv_task_chem_dog_times[["Df"]][3]`$; F-statistics = $`r round(anv_task_chem_dog_times[["F value"]][2], digits = 2)`, `r round(anv_task_chem_dog_times[["F value"]][3], digits = 3)`$; p values = $`r signif(anv_task_chem_dog_times[["Pr(>F)"]][2], digits=3)`, `r signif(anv_task_chem_dog_times[["Pr(>F)"]][3], digits = 3)`$). No individual comparison between target odor within a specific state were significant. The dogs did display a slight trend towards a difference when looking at the handler based on the target odor. However, a small sample size limited the statistical power of this comparison. 

Furthermore, the time spent sniffing for both target odors did not differ statistically (Welch Two Sample t-test; means: $`r round(sniff_eventtime_test[["estimate"]][2], digits = 3)`$ s, $`r round(sniff_eventtime_test[["estimate"]][1], digits = 2)`$ s, $P = `r round(sniff_eventtime_test[["p.value"]], digits = 3)`$), therefore demonstrating that the dogs spent about equal amounts of time searching for the two odors.

The counts of individual behaviors, including those that signify states of being, also did not result in any significant differences in how the dogs searched for the target odors (Fig. \@ref(fig:indiv-behavior-times)b). While the number of times the dogs turned their heads towards their handlers seemed to trend towards occurring more for NH~3~, the result was also insignificant ($P = `r signif(hturn_point_test[["p.value"]], digits = 3)`$). These results suggest there was no difference in states of being for dogs engaged in searching for either target odor. 

### Search success changes with target odorant


```{r search-times, echo=FALSE, fig.width = 6, fig.height = 4.0, fig.cap="Mean search times between types of runs (b) against alert success for both chemicals (a). Each point represents the mean for a single dog search event b."}

p2 <- ggplot(alerts, aes(x = dog, y = chemical, fill = success)) + 
  geom_tile(color = "black") + 
  scale_fill_manual(values = c("gray50", "gray90"), 
                    labels = c("not successful", "successful"), name = "") +
  scale_x_discrete(limits = rev(levels(alerts$dog))) +
  scale_y_discrete(position = "right", labels = c("2E1H", bquote(NH[3]))) +
  coord_flip()+
  ylab("Target") + xlab("Individual dog") + 
  theme_minimal() + theme(legend.position = "bottom")

p1 <- ggplot(total_search_times, aes(chemical, value, fill = factor(success))) + 
  geom_boxplot(outlier.shape = NA) + 
  geom_point(position=position_jitterdodge(dodge.width=0.8, jitter.width = 0.0), 
             alpha = 0.25, pch = 21) +
  scale_x_discrete(labels = c("2E1H", bquote(NH[3]))) +
  #annotate(geom = "text", x = 1, y = 34, label = "*",  size = 7) + 
  #annotate(geom = "line", x = c(0.75, 1.25), y = c(32,32), linewidth = 1) +
  scale_fill_manual(values = c("gray50", "gray90"), 
                    labels = c("not successful", "successful"), name = "") +
  ylab("Total time engaged\nin search (s)") + xlab(" ") + 
  theme_minimal() + theme(legend.position = "bottom")
(p1 + p2) + plot_annotation(tag_levels = "a") +
  theme(plot.tag = element_text(face = 'bold')) +
  theme(legend.position = 'bottom')

```


```{r search-time-test, include=FALSE}
eh_total_time_succ <- total_search_times$value[total_search_times$chemical =="2E1H" & total_search_times$success == TRUE]
eh_total_time_notsucc <- total_search_times$value[total_search_times$chemical =="2E1H" & total_search_times$success == FALSE]
eh_time_succ_test <- wilcox.test(eh_total_time_succ, eh_total_time_notsucc)

am_total_time_succ <- total_search_times$value[total_search_times$chemical =="Ammonia" & total_search_times$success == T]
am_total_time_notsucc <- total_search_times$value[total_search_times$chemical =="Ammonia" & 
                                                    total_search_times$success == F]
am_search_times <- wilcox.test(am_total_time_succ, am_total_time_notsucc)

succ_search_times <- wilcox.test(am_total_time_succ, eh_total_time_succ)

not_succ_search_times <- wilcox.test(am_total_time_notsucc, eh_total_time_notsucc)
```

In the trial, dogs had five choices for each search: alerting on one of each imprinting hole or not alerting at all. During the 2E1H trial, alerts were recorded as 2/14 (target), 1/14 (blank), 1/14 (methyl benzoate distractor), 0/14 (bromooctane distractor), 10/14 (no choice). For NH~3~, alerts were recorded for 11/14 (target), 0/14 (blank), 0/14 (methyl benzoate distractor), 0/14 (bromooctane distractor), 3/14 (no choice). Unexpectedly, these results indicate that 2/14 dogs were successful at finding 2E1H and 11/14 were successful at finding NH~3~, a difference which is significant (Fisher's exact test, $P = `r round(alert_test$p.value, digits = 3)`$; Fig. \@ref(fig:search-times)a).

With this search success difference, a difference in the total time engaged for each target odor between successful and unsuccessful was not found. The successful searches did not differ in time from the unsuccessful searches for both chemicals (Wilcoxon rank sum exact test, $W = `r am_search_times$statistic`$, $P = `r round(am_search_times$p.value, digits = 3)`$ for NH~3~ and $W = `r eh_time_succ_test$statistic`$, $P = `r round(eh_time_succ_test$p.value, digits = 3)`$ for 2E1H) or between the chemicals (Wilcoxon rank sum exact test, $W = `r succ_search_times$statistic`$, $P = `r round(succ_search_times$p.value, digits = 3)`$ for successful searches and $W = `r not_succ_search_times$statistic`$, $P = `r round(not_succ_search_times$p.value, digits = 3)`$ for unsuccessful searches; __Fig. \@ref(fig:search-times)b)__. 



## Discussion

The target odorants in this study possess differences in physical properties such that during close-quarters searching, transport of the odorant would be more dominated by diffusion for NH~3~ and advection for 2E1H during localizing (Table \@ref(tab:pe-table)). We predicted that this difference would result in significant differences in the way dogs would search odor plumes created by each target odorant, displayed by differences in movement, behavior stages of the search, and individual behaviors associated with focus and distress. Results show that the dogs engaged in different patterns of movement during searches for 2E1H and NH~3~ without changing the rate of individual behaviors associated with focus and distress.

Together, these results suggest that the physical properties of NH~3~ and 2E1H influence the movement of the dogs during search. The differences in plume characteristics between the two target odorants in this study made it easier for dogs to identify the edges of the plume during casting, where both target odors have $Pe >> 1$ in the medium range (Table \@ref(tab:pe-table). But the movement patterns of dogs diverged considerably where NH~3~ has $Pe \approx 1$ and 2E1H has $Pe > 1$. The more spread, diffuse plume of NH~3~ required more time during localizing. Anecdotally, many handler participants reported that their dogs seemed to react differently in movement and search patterning during training with NH~3~ as compared to training with 2E1H. NH~3~ seemed to present a novel challenge for the dogs.  The differences in properties also required the dogs to search in different areas with different movements in response to plume characteristics between NH~3~ and 2E1H. Other studies investigating odor capture by crabs across this $Pe$ value between air and water found support for morphological and kinematic differences being a result of performance differences of capture in the two fluid environments [@Waldrop:bluehermit; @Waldrop:entmodel]. This transition corresponds roughly to the behavioral transition between casting and localizing, observed by many studies that show distinct changes in behavior when an animal is so close to the source that the intermittent cues of a plume become less reliable [@weissburg1994odor; @Ache:2005; @liu2020mouse]. Our results are consistent with these observations and suggest that the target odorant's diffusivity can drive where and when this transition occurs for dogs during a search. 

Although the movements of dogs during the searches differed, individual behaviors did not (Fig. \@ref(fig:indiv-behavior-times)). Results indicated that dogs engaged in the same set of behaviors for each odorant, maintaining similar levels of focus and distress. This implies that the dogs were neither averse to the target odorants nor experienced different levels of distress during the trial searches. There was a slight, but insignificant, trend toward dogs looking at their handlers during the NH~3~ search unrelated to alert trained final responses, which may have reached significance with a larger sample size. 

We predicted that the difference in physical properties between the two target odorants would lead to dogs having more success at finding 2E1H as it is more similar in physical properties to the nose work odors that the dogs had been previously trained to locate. Nose work odors, the essential oils of birch, anise, and clove, consist broadly of turpenes which have more similar vapor pressures and diffusivities to 2E1H as compared to NH~3~. However, dogs successfully alerted on NH~3~ significantly more often than 2E1H. We attribute greater success in alerting to NH~3~ to the greater plume size of NH~3~ compared to 2E1H, making more odor available further outside the imprinting device. While the COMPS devices delivering odor matched the mass per unit time released into the air, greater diffusivity would result in more NH~3~ escaping the imprinting enclosure via the small hole on the front panel (see SI Fig. 1).

The interesting observation of difference in search success between the two target odors raises a potential limitation of the study. There are two explanations for these results: 1) the dogs were not able to recognize the target odor because they did not pick up enough odor to localize the source, or 2) the dogs were not able to recognize the target odor because they were not sufficiently trained to do so. Our experiment was not designed to, and is ultimately unable to, distinguish between differential success rates, it was an interesting result. There is evidence that suggest that dogs were sufficiently trained and not able to pick up enough 2E1H to localize the source. Dogs trained the same amount of time on the same aides as NH~3~ with high success rates for NH~3~. Dogs showed distinct kinematic and behavior differences after training. Before training, when the target odor and all distractors were novel, dogs spent less time localizing and showed spread kinematic densities during localizing for both target odors (NH~3~ and 2E1H) (SI Fig. 4a,b). After training, dogs spent more time localizing, showing different movement patterns between target odors (SI Fig. 4c,d) which indicates they were engaged in the search task and detected enough 2E1H during the post-training trial to transition from casting to localizing more often than in the pre-training trial. Furthermore, dogs also showed proficiency before and after the target trial using a similar device with nose work essential oils.

Few studies have investigated kinematic or behavioral changes of animals engaged in searching for odorants of different physical properties. Most odors are a mixture of individual odorants, each with their own physical properties [@Ache:2005]. Many common explosives give off multiple chemical odorants, and when trained dogs are challenged with odorants individually, they are less proficient in detection [@lorenzo2003laboratory; @harper2005identification]. Each odorant has individual physical properties, such as diffusion, which can influence the shape of the plume or the spatial and temporal pattern of signals, such as the odor filaments within the odor plume, delivered to dogs [@wang2021chemical; @heilman2014wildland; @asif2018air]. 

This novel exploration into the detailed ways that dogs search for odors based on the physical properties of odorants can also be useful for the wider investigation into and creation of artificial sensors. Beyond simply the sensitivity of the sensory itself, search patterning is a necessary component for locating various targets. Search patterns, such as the zig-zag and spiral search patterns, as well as other strategies have been taken successfully from animal models for use in robotics work [@lochmatter2007odor, @staymates2016biomimetic, @russell2001survey, and @hayes2002distributed]. Study of the detailed methods in which animals such as dogs search for odor plumes of different target odors will aid in the growth of artificial sensors and their ability to discriminate and locate specific odors.

The differential search success, although an interesting result, is also a potential limitation of the study. The experimental design did not include a positive control to ensure that dogs trained by their handlers were able to successfully find both target odors, so it is possible that dogs were not sufficiently trained to find 2E1H to perform the task during the trial. While reanalysis of results included in the supplemental information reexamines movement and behavior patterns removing unsuccessful dogs and trials and finds no major differences in conclusions, we cannot exclude this possibility. Further trials with a modified design could support the conclusions we present here.

Fourteen dogs participated and, while this sample size was adequate and gathered telling data, it may have also served as a limitation, as evidenced by a trend, and non-significant result for more time spent looking at the handler when searching for NH~3~. A larger sample size may have provided more statistically significant results for the study of individual behaviors and for alert success. With this, the dogs were only trained for six weeks on the target chemicals, and while there was a clear difference in their ability to and in how they searched for the odors, these differences may have been affected by the length and presence of training. Moreover, operational dogs were not utilized, instead, nosework dogs registered through the National Association of Canine Scent Work^TM^ participated. This may have been a limitation as there may be training, behavioral, and/or search pattern differences between operational and non-operational dogs. Yet the use of non-operational dogs is consistent with the participant population of the wider literature [@jezierski2008information; @concha2014using; @hepper2005many]. These limitations serve as a call for continued exploration on the subject to propel beneficial developments of canine searching for all operational capacities.



## Acknowledgements

This study was funded by Office of Naval Research awards #N00014-21-1-2347 (to L. Waldrop) and #N00014-21-1-2873 (to L. DeGreeff). The authors wish to thank Brandi Bryant and Jenny Brackett of the The Hounds Grounds in Huntington Beach, CA for providing the venue for the trials; Amy Herot and Jill-Marie O'Brien from NASCW for help in recruiting participants; the dog-handler teams for donating their time and effort; Monica Moljo, Alexa Ortega, Alexander Orlove, and Evan Hughes for helping at the trials; and the editor and anonymous reviewers for comments that improved the manuscript during revisions.

## Author Contributions

 - DM: Ran trials, created ethogram, analyzed data, wrote manuscript
 - LB, NH: ran trials, analyzed data, wrote manuscript
 - PS: ran trials, wrote manuscript
 - AS,CC: analyzed kinematics, wrote manuscript
 - LD: conceived of idea, ran trials, wrote manuscript
 - LDW: conceived of idea, ran trials, analyzed data, wrote manuscript

## Competing Interests Statement

No authors have no competing interests. 


## Data Availability

All data and code used to produce results can be found on Github at https://github.com/lindsaywaldrop/odor-plume-search. 


## References 
