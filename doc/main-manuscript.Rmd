---
title: "Physical properties of odorants affect behavior of trained detection dogs during close-quarters searches"
author: 
 - Daniel Mejia^1^, Lydia Burnett^2^, Nicholas Hebdon^1^, Peter Stevens^3^, Alexis Shiber^1^, Clay Cranston^1^, Lauryn DeGreeff^2^, and Lindsay D. Waldrop^1^ 
date: "`r Sys.Date()`"
output: 
  bookdown::pdf_document2:
    number_sections: false
    toc: false
    keep_tex: yes
bibliography: references.bib
csl: scientific-reports.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width=8)
options(knitr.graphics.error = FALSE)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```
 
 1. Schmid College of Science and Technology, Chapman University
 2. Global Forensic and Justice Center and Department of Chemistry and Biochemistry, Florida International University
 3. The Scentsable K9, El Cajon, CA

Corresponding author: L.D. Waldrop waldrop@chapman.edu
```{r results_code, include=FALSE}
# Loading required libraries
library(knitr)
library(tidyr)
library(kableExtra)
library(ggplot2)
library(patchwork)
library(viridis)
library(cluster)

# Loading required functions:
source("./src/kinematic_fxns.R")

hole_bump_x <- 0.01
hole_bump_z <- 0.06
chem_colors <- c("#F3C8C0", "#BC8DA6")
task_labs <- c("Off task", "Casting", "Localizing", "Alert")
state_behavior_labels <- c("Jumping", "Look at handler", "Pawing", "Sniffing")
point_behavior_labels <- c("Chest tightness", "Eye convergence", "Facial tensing",
                           "Head turn", "Lip lick", "Ear prick", "Head snap", 
                           "Tail wag")

#To rerun kinematic track analysis, uncomment the following line: 
#source("./src/kinematics_paper_analysis.R")

# And change the date to today's date:
analysis_date <- "2023-12-12"

# Loads previously analyzed data:
tracks <- read.csv(paste0("./results/csv-files/kinematics-final-tracks_", analysis_date, 
                          ".csv"))
tracks$task <- factor(tracks$task, levels = c("t", "c", "o", "a"))
trial_holes <- read.csv(paste0("./results/csv-files/trial_holes_", analysis_date, 
                               ".csv"))
dog_mean_hot_dist <- read.csv(paste0("./results/csv-files/dog-mean-hot-dist_", 
                                     analysis_date, ".csv"))

dog_mean_total_task_time <- read.csv(paste0("./results/csv-files/dog-mean-total-task-time_",
                                            analysis_date, ".csv"))
dog_mean_total_task_time$dog <- factor(dog_mean_total_task_time$dog)
dog_mean_total_task_time$chemical <- factor(dog_mean_total_task_time$chemical)
dog_mean_total_task_time$task <- factor(dog_mean_total_task_time$task, levels = c("t", "c", "o", "a"))

dog_mean_event_times <- read.csv(paste0("./results/csv-files/dog-mean-event-times_",
                                            analysis_date, ".csv"))

dog_point_counts <-  read.csv(paste0("./results/csv-files/dog-point-counts_",
                                            analysis_date, ".csv"))

alerts <-  read.csv("./data/alert_success.csv")
alerts$dog <- factor(alerts$dog)
alerts$chemical <-factor(alerts$chemical)
```



```{r pe-calc, include=FALSE}
Da <- 0.002403 # m2/s
De <- 0.000663 # m2/s
U <- 0.01 # m/s
L_long <- 10
L_cast <- 1
L_local <- 0.2
Pe_e_long <- (L_long*U)/(De)
Pe_a_long <- (L_long*U)/(Da)
Pe_e_cast <- (L_cast*U)/(De)
Pe_a_cast <- (L_cast*U)/(Da)
Pe_e_local <- (L_local*U)/(De)
Pe_a_local <- (L_local*U)/(Da)
Pe <- data.frame("Description" = c("Far field", "Medium range", "Close quarters"),
                 "LengthL" = c(L_long, L_cast, L_local), 
                 "Pe2E1H" = c(Pe_e_long, Pe_e_cast, Pe_e_local),
                 "PeNH~3~" = c(Pe_a_long, round(Pe_a_cast), signif(Pe_a_local, 2)))
```

<!-- 

Editing passes / finishing list:
 - edit for tense agreement
 - typo pass, grammar, reference number
 - make sure odor and odorant are used properly (Intro DONE)
 - make sure behavior, search stage, and movement are used properly (Intro DONE)
 
-->


## Abstract


Trained detection dogs have a unique ability to find the sources of target odors in complex fluid environments. How dogs derive information about the source of an odor from an odor plume comprised of odorants with different physical properties, such as diffusivity, is currently unknown. Two volatile chemicals associated with explosive detection, ammonia (NH~3~, derived from ammonium nitrate-based explosives) and 2-ethyl-1-hexanol (2E1H, associated with composition C4 plastic explosives) were used to ascertain the effects of the physical properties of odorants on the search behavior and motion of trained dogs. NH~3~ has a diffusivity 3.6 times that of 2E1H. Fourteen sport-detection dogs were recruited to train on each target odorant using controlled odor mimic permeation systems as training aids over six weeks and then tested in a controlled-environment search trial where behavior, motion, and search success were analyzed. Our results indicate the target-odorant influences search motion and time spent in the stages of searching, with dogs spending more time in larger areas while localizing NH~3~. This aligns with the greater diffusivity of NH~3~ driving diffusion-dominated odor transport when dogs are close to the odor source in contrast to the advection-driven transport of 2E1H at the same distances.

## Introduction

Dogs are trained to locate items of interest via the detection of chemical cues (odors), including contraband, arms, explosives, disease, and humans [@furton2001scientific; @settles2005sniffers; @cablk2008olfaction; @boedeker2012sniffer; @wasser2012using;  @pemberton2013bloodhounds;  @narayanasamy2023hide]. Trained operational dogs are a key feature of many security and law enforcement programs, despite the cost and difficulty of selecting, training, and maintaining them [@leighton2018solution; @lazarowski2020selecting]. Technology of artificial sensors now rivals the sensitivity of a dog’s nose, yet dogs continue to out perform these sensors in their superior selectivity and due to their ability to interpret the complex fluid problem of locating a target odor's source [@furton2001scientific; @settles2005sniffers; @cablk2008olfaction; @eu2013olfactory; @reddy2022olfactory].

To find the source of an odor, dogs must search an odor plume that is created by the interactions between an odor source and the environment [@murlis1992odor;  @settles2005sniffers; @young2020odors]. The odor, and its individual odorants, can emanate into the air in two ways: simple diffusion or bulk fluid transport by air currents (advection). Odor diffuses from the source into the surrounding air and is carried away from the source via air currents [@elkinton1984odor; @young2020odors]. Air shearing across itself forms high-concentration filaments of odor in eddies, which sometimes resemble long, thin ribbons. Air swirls, breaks, and translates these ribbons. Diffusion spreads odors between layers of air in eddies, softening the edges of the odor filaments [@koehl2001lobster; @young2020odors]. Both environmental features, such as wind and objects in the area, and the physical properties of an odorant, such as diffusivity, can impact the distribution and concentration of the plume's odor filaments [@koehl2006; @young2020odors].

When a dog uses olfaction to investigate a plume, it samples the plume by sniffing or taking in discrete volumes  of the air immediately surrounding its nose [@Dethier:1987; @settles2005sniffers]. The signals that the dog encounters at the scale of its nose are intermittent; odor is contained in high-concentration filaments which the dog samples between low or no odor samples [@koehl2001lobster; @reddy2022olfactory]. Thus, odor information from a plume is complex in space and time and not a steady concentration gradient from start to source [@murlis1992odor; @settles2005sniffers; @young2020odors]. 

Dogs must derive enough information from sniffing within a plume to find the source of an odor from a long distance to nearby the source. Dogs and other animals use two sets of behaviors during a search to gather information from an intermittent odor plume: casting and localizing [@weissburg1994odor; @settles2005sniffers]. Casting is the appearance of zig-zagging in moths and crabs, constant turning in fish and birds, or head turning in mice and dogs [@farkas1972chemical; @murlis1992odor; @weissburg1994odor; @belanger1996adaptive; @hepper2005many; @settles2005sniffers; @prada2018birds]. Casting typically occurs far from the source and allows the animal to enter, exit, and re-enter the edges of the plume, acquiring information on the odor's source from the spatial and temporal patterns of signals as well as flow direction and speed [@farkas1972chemical; @weissburg1994odor; @belanger1996adaptive;  @porter2007mechanisms; @liu2020mouse]. Once very close to the source, these signals become less reliable and animals switch to localizing behaviors to determine the exact position of the odor source [@weissburg1994odor; @Ache:2005; @gire2016mice; @reddy2022olfactory]. 

To understand the balance between these two searching stages, the temporal and spatial shape of the plume and how it develops at a distance from the source is important. The shape of the plume depends on both advection and diffusion, which can influence the way odor moves local to the source. The Péclet number describes the ratio between advection and diffusion in odor transport: $Pe = UL/D$, where $U$ is the external flow speed, $L$ is a characteristic length, and $D$ is the diffusion coefficient of the odorant. When considering transport of odor far from the source ($L$ is large), the $Pe$ is much greater than one, indicating that bulk air movement is the primary mode of transport and differences in diffusivity have little importance. When considering close-quarters searching, characteristic lengths would be much smaller. Here, even moderate differences in diffusivity between odorants can drive $Pe$ below one, indicating diffusion-driven transport (Table \@ref(tab:pe-table)).

We know that environmental processes that affect advection can produce effects in search behavior and success in dogs that engage in long-distance searching [@cablk2008olfaction; @ruzicka2012does; @jinn2020ambient], but there have been fewer studies investigating how an odor's physical properties may impact close-quarters searches. Many operational dogs engage in close-quarters searching for contraband and explosives in rooms or enclosed spaces or items, such as vehicles, packages, or luggage, where the dog begins its search close to the odor source. While odors of different physical properties can also affect search success of narcotics and explosive detection dogs [@furton2001scientific], there has been no study on how these differences might affect the behavior and movement of dogs during the casting and localizing stages of active searches. Since these types of searches can have $Pe < 1$, it is possible that odors of different diffusivities could impact the way dogs search and their success in close quarters.

To investigate how the physical properties of odors can impact close-quarters searching and search success, we observed the unrestricted search behavior of trained dogs in a standardized search environment with one of two target odorants: ammonia (NH~3~) and 2-ethyl-1-hexanol (2E1H). These chemicals are important for detection of explosives, as they are the dominant odorants in the headspace of two common explosives (NH3 is a degradant of ammonium nitrate and 2E1H is associated with the plasticizers used in the plastic explosive, C4) [@southwest1973narcotic; @furton2001scientific;  @katilie2019quantitative; @gazit2021dogs; @degreeff2021headspace; @frank2022explosives]. NH~3~'s diffusion coefficient is 3.6 times that of 2E1H (Table \@ref(tab:pe-table)) [@spiller1989determination; @guard1999chemical; @wakayama2019comprehensive].

We expected the behavior and motion of the dogs would differ between the two target odorants due to their physical properties, with movement distributed more widely during localizing NH~3~, where $Pe < 1$. We also expected that behaviors associated with stress, such as lip licking, would occur more often during searches for NH~3~ than 2E1H due to the unfamiliar plume characteristics produced by NH~3~.

```{r pe-table, echo=FALSE}
kable(Pe, "simple", col.names = c("", "Length, $L$ (m)", "$Pe$ 2E1H", 
                                  "$Pe$ NH3"), 
             align = "c", digits = c(0, 1, 0, 1), row.names = F,
      caption="Estimated Péclet numbers ($Pe$) for different length scales where the flow speed ($U$) is 1 cm s^-1^ and the diffusion coefficients ($D$) are 0.0663 and 0.2403 cm^2^ s^-1^ for 2E1H and NH~3~, respectively.")
```



## Methods

#### Materials 

Ammonium hydroxide (Sigma-Aldrich) and 2-etyhyl-1-hexanol (Sigma-Aldrich) were selected as the two target odorants of interest due to differences in their physical properties (SI Table 1). In order to train the two different target odors, handlers were given controlled odor mimic permeation systems (COMPS) as training aids. COMPS are a tool that controls odor availability during training. For this study, each COMPS consists of 20 $\mu$L of analyte pipetted onto a 2 inch by 2 inch piece of cotton-blend gauze pad (Dukal, LLC) which was heat-sealed in a 2 by 3 inch plastic bag. The analyte is released at a rate determined by the thickness and surface area of the bag [@simon2019]. In order to equalize the amount of 2E1H and ammonia presented to the canine during training, a 3 MIL low density polyethylene bag (LDPE; Uline) was used 2E1H and a 8 MIL LDPE bag (Uline) was used for ammonia. Non-target or distractor odorants were prepared in a similar way for methyl benzoate (Sigma-Aldrich; 3 MIL bag) and bromooctane (Sigma-Aldrich; 8 MIL bag).


### Participants 

Fourteen civilian canines were recruited through the National Association of Canine Scent Work (NACSW)(TM). NACSW canines train to detect essential oils for competition. Canines recruited from Nosework 3 title or higher. Dogs at this level are trained to detect multiple odor sources, trials with blanks, and in various search situations. Three small dogs ($< 30$ lbs) and eleven large dogs ($\geq 30$ lbs) were included of all different breeds (SI Table 2). The handlers were not compensated for participation. During the training period, handlers logged the time in which they used each COMPS and were instructed to throw away the COMPS and open a new one after it was exposed to the air for a total of six hours. Handler-dog teams were given six weeks to train with the COMPS before participating in the trials. Each handler-dog team trained individually as they would for typical Nosework odor competitions. 

### Animal Use Ethics Statement

All experimental procedures in this study were approved by the Institutional Animal Care and Use Committee at Florida International University (FIU IACUC protocol #201314). The study observed all federal, state, and local regulations on the use of vertebrate animals in research. All appropriate permissions from institutions and trial locations were obtained to use dogs in research for this study.


### Experimental Setup and Procedure

The trial was held in Huntington Beach, California in February, 2023 at a dog training facility. Two plywood trials walls were set up in the middle of each location (SI Figure 1). The walls consisted of three four foot by four foot panels of 1/2 inch plywood with two inch by three inch studs that were connected in a C pattern, the center panel of which contained four imprinting holes (3" interior, 4" exterior ABS  toilet flange; OATEY) spaced seven inches horizontally apart. One wall was for large dogs where the imprinting holes were placed 16 inches on center from ground; another was for small dogs and had the holes spaced seven inches on center from the ground. Each hole presented a single odorant to the dogs through a small opening on a plastic PVC cap. One COMPS was placed in three of the four holes,  containing one of two distracting odorants (either methyl benzoate or bromooctane) or one of the two target odorant (either 2E1H or NH~3~). A fourth hole had no odor (blank). For additional details, see supplementary information.

COMPS were placed in the imprinting devices five to ten minutes before dogs were allowed to interact with the wall. Dogs were then run consecutively. No special effort was made to reset or control the odor plume from the wall between dogs. After each run with a target odor, distracting-odor COMPS were replaced. The white, PVC cap and ABS imprinting hole were replaced between 2E1H and NH3 to limit cross-contamination between target odors. A 15- to 20-minute period between runs with each target odor was given to allow the previous odor plumes to dissipate. 

Dogs were allowed to search a similar imprinting wall with a Nosework odor source before and after each experimental run. Each dog was sent to their corresponding wall twice, once where the target odor was NH~3~ and the other when it was 2E1H. Two observers remained behind the dog and handler dyad while they were sent to the corresponding wall to note observations and to coach the handler, if needed. The handlers were blind to which hole contained the target odor. The handler was instructed to search the wall and indicate if their dog alerted to the location of the odor source. Once the dog had searched the wall and either alerted to the target odor or had worked the wall sufficiently, the dog-handler team was exited the facility. To assess whether the dogs were more successful at locating one odor or another, the successful versus unsuccessful alerts were noted by both observers during each run.


### Kinematic Analysis

Two video cameras (GoPro Hero 8 Black, GoPro, San Mateo, CA) were placed in view of the front of the wall where dogs interacted with odors, one above the holes and one to the right side of the trial wall, resulting in a top view and side view, respectively (SI Fig. 2). Calibration footage was taken each time the cameras were initially set up or moved. For additional details, see supplementary information.

Movements of dogs during the search were quantified using the tracking software DLTdv8 [@hedrick2008software]. Two points on the dogs' heads (the middle of the tip of the nose, in between the dogs' eyes) were digitized by hand in each frame of the two synced video views in DLTdv8. The two dimensional points from each video view were then used with easyWand calibration to calculate the three-dimensional position of each digitized point [@theriault2014protocol]. Three-dimensional points were then exported for further analysis using custom software in R version 4.3.1 [@Rcoreteam] (See data availability for location of code used for analyses). The same two coders for the behavioral analysis completed the kinematic analysis, with one coder acting as a confirmatory judge of the first coder’s analysis.


### Behavioral Analysis

To analyze the behaviors occurring along the search path, two ethograms were created to code behavioral stages related to searching and other, relevant individual behaviors that occurred during the search. Each ethogram was created using the Behavioral Observation Research Interactive Software (BORIS) and coded using the same software [@friard2016boris]. Behavior states and individual behaviors were scored by two trained observers (one for behavior states, one for individual behaviors). 

Using a combination of classical and operant conditioning, dogs are trained to behave a certain way once they have detected a target odor and are as close to the source of that odor as they can possibly get. The use of a detection dog and location of one or more of the target odors will typically go as follows: (1) The dog is deployed with a search command. (2)  __Casting stage__: the dog will start sampling the air currents trying to locate an odor plume (i.e., ``scent cone").  As air current carries the target odor, dogs locate the edges of the odor plume and try to find the source. The dog will move its head from side to side trying to locate the edges of the odor plume and the odor source. (3)  __Localizing stage__: once the dog has detected the odor plume, it engages in noticeable changes of behavior. The dog often becomes visibly excited with its bodies becoming more rigid, changes in rates of breathing, and appear more focused. The dog will close its mouth, very focused sniffing occurs, and sniffing frequency increases. Sometimes the dog will appear to become frantic or engage in a sudden turn of the head. (4)  __Alert phase__: after the dog has successfully located the source of the odor, the dog has been conditioned to perform a specific behavior, often called a Trained Final Response (TFR). The most common TFR's in professional detection work is a sit or freeze and in civilian sport detection is a head turn and look at the handler. The dog is then rewarded with a reinforcer. 

Behavioral stages were defined stages that correspond to the search stages explained above: casting, localizing, and alerting. An off-task stage was also added for times where the dog was not engaged in the search task. The current literature has agreed upon the three defined search phases in dogs defined in Thesen et al.[@thesen1993behaviour] (initial, deciding, and tracking phases), where each phase differs from the other based on speed, sniff frequency, and time spent sniffing. The addition and use of distinct casting and localizing stages in the current study bridges the gap in terminology from tracking and trailing to the wider olfactory literature, as well as remaining consistent with the stages outlined in Thesen et al. [@thesen1993behaviour; @weissburg1994odor; @settles2005sniffers; @belanger1996adaptive; @hepper2005many; @farkas1972chemical; @prada2018birds; @murlis1992odor; @gire2016mice; @reddy2022olfactory]. Therefore, the terms used in the current study better classify and describe the search stages dogs iterate through as they navigate the odor plumes they search. 


Individual behaviors were defined as distinct behaviors displayed independently of search stage and collected as both the number of incidents and amount of time the behaviors were displayed. The behaviors were selected after observations made during the trials and because they have been linked with psychological and physiological states of being, such as confusion, avoidance, anxiousness, focus, and alertness [@bodnariu2008indicators; @melco2020investigation; @thesen1993behaviour]. Twelve individual behaviors were chosen and coded (see SI Table 3 for definitions). All behaviors fell into two major categories of physiological stress: focused/attentive behavior, which can also be classified into the greater category of eustress, or distress.  

In BORIS, search stages were scored as start/stop during the timeline of the search. The individual behaviors were collected as both count data and amount of time the behaviors were displayed. Across the two trial dates, fifty-five videos were coded twice, once with each ethogram. The video was coded for the entire time the dog was fully visible within the video. There was one trained coder for each ethogram. Once the videos were coded, the two behavior types were paired statistically so that the appropriate individual behaviors fell within the relevant behavioral state according to video timing.

   
### Statistical analysis

Statistical analyses of search stage and behavior data was performed in R version 4.3.1 [@Rcoreteam]. Data for comparison were tested for normality with a Shapiro-Wilk test and for significance using Welch's t-test, Wilcoxon rank-sum test, or signed rank test, noted along with statistical values reported below. P-values were adjusted for multiple comparisons using a Bonferroni correction. To compare where the dogs concentrated their efforts during different types of behavior, a cluster comparison for two behavior types (casting and localizing) was performed. Clusters were identified with a k-means analysis using the k-means  function in base R. K-means clustering is a method that reduces the within cluster variance relative to the clusters’ mean for a specified number of groups [@Hartigan_Wong_1979]. K-means quantification requires the user to specify the number of clusters to be found. In this analysis a cluster would equate to a high density zone of a given behavior. For our experimental configuration this was set to five, one per odor hole and one additional for background/off-wall behavior. To evaluate the accuracy of this clustering scheme for each chemical relative to our expectation we then calculated the gap statistic of each cluster using the function `clusGap` from cluster package was then calculated [@clusterpkg]. The gap statistic summarized the distance of the pooled sum of the squares for a cluster relative to that data under a null distribution [@tibshirani_estimating_2001]. For additional details, see supplementary information.


## Results

### Target odor affects search patterns of dogs


```{r k-mean-calcs, include=FALSE}
# K means clustering analysis
set.seed(15)
scaled_tracks <- na.omit(tracks[tracks$point == "nose", c("x","y","z","task","run")])
scaled_tracks$x <- (scaled_tracks$x - min(scaled_tracks$x))/(max(scaled_tracks$x)-min(scaled_tracks$x))
scaled_tracks$y <- (scaled_tracks$y - min(scaled_tracks$y))/(max(scaled_tracks$y)-min(scaled_tracks$y))
scaled_tracks$z <- (scaled_tracks$z - min(scaled_tracks$z))/(max(scaled_tracks$z)-min(scaled_tracks$z))

cluster_2E1H_casting <- calc_kmeans(scaled_tracks, 1, "c", 5)
cluster_2E1H_detailing <- calc_kmeans(scaled_tracks, 1, "o", 5)
cluster_Amm_casting <- calc_kmeans(scaled_tracks, 2, "c", 5)
cluster_Amm_detailing <- calc_kmeans(scaled_tracks, 2, "o", 5)
```

```{r data-setup-density-plots, include=FALSE}
dat_2E1H_casting <- na.omit(tracks[tracks$point == "nose" & tracks$run == 1 & 
                                     tracks$task == "c",])
dat_2E1H_casting$cluster <- factor(cluster_2E1H_casting$cluster_points)

dat_2E1H_detailing <- na.omit(tracks[tracks$point == "nose" & tracks$run == 1 & 
                                       tracks$task == "o",])
dat_2E1H_detailing$cluster <- factor(cluster_2E1H_detailing$cluster_points)

dat_Amm_casting <- na.omit(tracks[tracks$point == "nose" & tracks$run == 2 & 
                                    tracks$task == "c",])
dat_Amm_casting$cluster <- factor(cluster_Amm_casting$cluster_points)

dat_Amm_detailing <- na.omit(tracks[tracks$point == "nose" & tracks$run == 2 & 
                                      tracks$task == "o",])
dat_Amm_detailing$cluster <- factor(cluster_Amm_detailing$cluster_points)
```


```{r stats-calc, include=FALSE}

#testing distance from source for both odors in each pattern
anova_dist_test <- anova(lm(value~chemical*task, data = dog_mean_hot_dist))
casting_dist_test <- t_test_sniff(dog_mean_hot_dist, "casting", 4)
detailing_dist_test <- t_test_sniff(dog_mean_hot_dist, "detailing", 4)

# manually testing distance in casting vs detailing for ammonia
amm_sniff_c <- dog_mean_hot_dist$value[dog_mean_hot_dist$task == "casting" & 
                                         dog_mean_hot_dist$chemical == "Ammonia"]
shapiro.test(amm_sniff_c)
amm_sniff_o <- dog_mean_hot_dist$value[dog_mean_hot_dist$task == "detailing" & 
                                         dog_mean_hot_dist$chemical == "Ammonia"]
shapiro.test(amm_sniff_o)
chemical_amm_dist_test <- t.test(amm_sniff_c, amm_sniff_o)
chemical_amm_dist_test$p.value <- p.adjust(chemical_amm_dist_test$p.value, 
                                           method = "bonferroni", n = 4)

# manually testing distance in casting vs detailing for 2E1H
eh_sniff_c <- dog_mean_hot_dist$value[dog_mean_hot_dist$task == "casting" & 
                                         dog_mean_hot_dist$chemical == "2E1H"]
shapiro.test(eh_sniff_c)
eh_sniff_o <- dog_mean_hot_dist$value[dog_mean_hot_dist$task == "detailing" & 
                                         dog_mean_hot_dist$chemical == "2E1H"]
shapiro.test(eh_sniff_o)
chemical_2E1H_dist_test <- t.test(eh_sniff_c, eh_sniff_o)
chemical_2E1H_dist_test$p.value <- p.adjust(chemical_2E1H_dist_test$p.value, 
                                           method = "bonferroni", n = 4)

# Mean time spent in casting or detailing b/w chemicals
casting_tasktime_test <- t_test_sniff(dog_mean_total_task_time, "c", 4)
detailing_tasktime_test <- t_test_sniff(dog_mean_total_task_time, "o", 4)
anova_tasktime_test <- anova(lm(value ~ chemical * task, 
                                data = dog_mean_total_task_time))


# Testing total time in casting versus detailing for 2E1H (significant)
eh_cast_time <- dog_mean_total_task_time$value[dog_mean_total_task_time$task =="c" &
                                                   dog_mean_total_task_time$chemical == "2E1H"]
eh_detail_time <- dog_mean_total_task_time$value[dog_mean_total_task_time$task =="o" &
                                                   dog_mean_total_task_time$chemical == "2E1H"]
eh_cast_detail_test <- t.test(eh_cast_time, eh_detail_time)
eh_cast_detail_test$p.value <- p.adjust(eh_cast_detail_test$p.value,
                                           method = "bonferroni", n = 2)

# Testing total time in casting versus detailing for Ammonia (not significant)
am_cast_time <- dog_mean_total_task_time$value[dog_mean_total_task_time$task =="c" &
                                                   dog_mean_total_task_time$chemical == "Ammonia"]
am_detail_time <- dog_mean_total_task_time$value[dog_mean_total_task_time$task =="o" &
                                                   dog_mean_total_task_time$chemical == "Ammonia"]
am_cast_detail_test <- wilcox.test(am_cast_time, am_detail_time)
am_cast_detail_test$p.value <- p.adjust(am_cast_detail_test$p.value,
                                           method = "bonferroni", n = 2)

# Testing 2E1H versus Ammonia for each state behavior
look_eventtime_test <- t_test_sniff(dog_mean_event_times, "l", 4)
sniff_eventtime_test <- t_test_sniff(dog_mean_event_times, "s", 4)
jump_eventtime_test <- t_test_sniff(dog_mean_event_times, "j", 4)
paw_eventtime_test <- t_test_sniff(dog_mean_event_times, "p", 4)

anv_task_chem_dog_times <- anova(lm(value ~ task * chemical, 
                                    data = dog_mean_event_times))

# Testing 2E1H versus Ammonia for point behavior
hturn_point_test <- t_test_sniff(na.omit(dog_point_counts), "h", 8)


# Setting up matrix for fisher's exact test on alerts
e_alerts_true <- sum(alerts$success[alerts$chemical=="2E1H"] == TRUE)
e_alerts_false <- sum(alerts$success[alerts$chemical=="2E1H"] == FALSE)
a_alerts_true <- sum(alerts$success[alerts$chemical=="Ammonia"] == TRUE)
a_alerts_false <- sum(alerts$success[alerts$chemical=="Ammonia"] == FALSE)

##alert test to see difference between success counts for two chemicals
alert_mat<-matrix(c(e_alerts_true, e_alerts_false, a_alerts_true, a_alerts_false), 
                  byrow = T, nrow=2)
alert_test <- fisher.test(alert_mat)


total_search_times <- data.frame("dog" = rep(NA, 28), 
                                 "chemical" = rep(NA, 28),
                                 "success" = rep(NA, 28),
                                 "value" = rep(NA, 28))
counter <- 0
for(i in 1:nlevels(dog_mean_total_task_time$dog)){
  for(j in 1:nlevels(dog_mean_total_task_time$chemical)){
    counter <- counter + 1
    total_search_times$dog[counter] <- levels(dog_mean_total_task_time$dog)[i]
    total_search_times$chemical[counter] <- levels(dog_mean_total_task_time$chemical)[j]
    task_sub <- dog_mean_total_task_time[dog_mean_total_task_time$dog== levels(dog_mean_total_task_time$dog)[i] &
                                           dog_mean_total_task_time$chemical == 
                                                  levels(dog_mean_total_task_time$chemical)[j], ]
    total_search_times$value[counter] <- sum(task_sub$value) - task_sub$value[task_sub$task == "t"]
    total_search_times$success[counter] <- alerts$success[alerts$dog == 
                                                            levels(dog_mean_total_task_time$dog)[i] & 
                                                            alerts$chemical == 
                                                          levels(dog_mean_total_task_time$chemical)[j]]
  }
}

#Difference b/w overall search times (non-sig)
E_search_time <- total_search_times$value[total_search_times$chemical=="2E1H"]
A_search_time <- total_search_times$value[total_search_times$chemical=="Ammonia"]
total_search_test <- t.test(E_search_time, A_search_time)
```


```{r frontwall-casting, fig.cap="Point-density plots (a and b) and k-means clustering plots (c and d) of the front view of trial wall during casting stage for 2E1H (a, c) and NH~3~ (b, d). Location of imprinting source holes marked with colored circles (red indicates location of target odorant, blue are distractors, gray is blank).",echo=FALSE, warning=FALSE}

p2E1H_casting_density <- ggplot(dat_2E1H_casting, aes(x, z)) + 
  stat_density2d(geom = "polygon", aes(fill=..level.., alpha = ..level..), contour = T) +
  scale_fill_viridis(limits = c(0, 21), name = "density", discrete = F) + 
  scale_alpha_continuous(limits = c(0, 21), name = "", guide = "none") + 
  geom_point(data = trial_holes[7, ], mapping = aes(x + hole_bump_x, # blank
                                                    z + hole_bump_z, 
                                                    color = NULL, 
                                                    shape = NULL), 
             fill = "gray30", size = 3, pch = 21) + 
  geom_point(data = trial_holes[8, ], mapping = aes(x + hole_bump_x, # methyl benzoate
                                                    z + hole_bump_z, 
                                                    color = NULL, 
                                                    shape = NULL), 
             fill = "#46698C", size = 3, pch = 21) + 
  geom_point(data = trial_holes[9, ], mapping = aes(x + hole_bump_x, # bromooctane
                                                    z + hole_bump_z, 
                                                    color = NULL, 
                                                    shape = NULL), 
             fill = "#46698C", size = 3, pch = 21) + 
  geom_point(data = trial_holes[6, ], mapping = aes(x + hole_bump_x, # HOT
                                                    z + hole_bump_z, 
                                                    color = NULL, 
                                                    shape = NULL), 
             fill = "red", size = 3, pch = 21) +
  xlim(-1.1, 0.5) + ylim(-0.1, 0.8) +
  coord_fixed() +
  ggtitle("2E1H") +
  ylab("Point density\n\nDistance from floor") + xlab(" ")+
  theme_minimal() + theme(plot.title = element_text(hjust = 0.5))

p2E1H_casting_cluster <- ggplot(dat_2E1H_casting, aes(x, z, color = cluster)) + 
  geom_point(pch=19, alpha = 0.1) + 
  stat_ellipse(aes(fill = cluster), type="t", geom = "polygon", alpha=0.4)+
  scale_color_viridis(discrete = T, option = "E") + 
  scale_fill_viridis(discrete = T, option = "E") +
  geom_point(data = trial_holes[7, ], mapping = aes(x + hole_bump_x, # blank
                                                    z + hole_bump_z, 
                                                    color = NULL, 
                                                    shape = NULL), 
             fill = "gray30", size = 3, pch = 21) + 
  geom_point(data = trial_holes[8, ], mapping = aes(x + hole_bump_x, # methyl benzoate
                                                    z + hole_bump_z, 
                                                    color = NULL, 
                                                    shape = NULL), 
             fill = "#46698C", size = 3, pch = 21) + 
  geom_point(data = trial_holes[9, ], mapping = aes(x + hole_bump_x, # bromooctane
                                                    z + hole_bump_z, 
                                                    color = NULL, 
                                                    shape = NULL), 
             fill = "#46698C", size = 3, pch = 21) + 
  geom_point(data = trial_holes[6, ], mapping = aes(x + hole_bump_x, # HOT
                                                    z + hole_bump_z, 
                                                    color = NULL, 
                                                    shape = NULL), 
             fill = "red", size = 3, pch = 21) +
  xlim(-1.2, 0.5) + ylim(-0.1, 0.8) +
  coord_fixed() +
  ylab("k-mean clustering\n\nDistance from floor") + xlab("Along face of wall")+
  theme_minimal() 

pAmm_casting_density <- ggplot(dat_Amm_casting, aes(x, z)) + 
  stat_density2d(geom = "polygon", aes(fill=..level.., alpha = ..level..), contour = T) +
  scale_fill_viridis(limits = c(0, 21), name = "density", discrete = F) + 
  scale_alpha_continuous(limits = c(0, 21), name = "", guide = "none") + 
  geom_point(data = trial_holes[6, ], mapping = aes(x + hole_bump_x, # bromooctane
                                                    z + hole_bump_z, 
                                                    color = NULL, 
                                                    shape = NULL), 
             fill = "#46698C", size = 3, pch = 21) + 
  geom_point(data = trial_holes[7, ], mapping = aes(x + hole_bump_x, # methyl benzoate
                                                    z + hole_bump_z, 
                                                    color = NULL, 
                                                    shape = NULL), 
             fill = "#46698C", size = 3, pch = 21) + 
  geom_point(data = trial_holes[8, ], mapping = aes(x + hole_bump_x, # blank
                                                    z + hole_bump_z, 
                                                    color = NULL, 
                                                    shape = NULL), 
             fill = "gray30", size = 3, pch = 21) + 
  geom_point(data = trial_holes[9, ], mapping = aes(x + hole_bump_x, # HOT
                                                    z + hole_bump_z, 
                                                    color = NULL, 
                                                    shape = NULL), 
             fill = "red", size = 3, pch = 21) +
  xlim(-1.2, 0.5) + ylim(-0.1, 0.8) +
  coord_fixed() +
  ggtitle(bquote(NH[3])) +
  ylab(" ") + xlab(" ")+
  theme_minimal() + theme(plot.title = element_text(hjust = 0.5))

pAmm_casting_cluster <- ggplot(dat_Amm_casting, aes(x, z, color = cluster)) + 
  geom_point(pch=19, alpha = 0.1) + 
  stat_ellipse(aes(fill = cluster), type="t", geom = "polygon", alpha=0.4)+
  scale_color_viridis(discrete = T, option = "E") + 
  scale_fill_viridis(discrete = T, option = "E") +
  geom_point(data=trial_holes[6,], mapping=aes(x+hole_bump_x, # bromooctane
                                                               z+hole_bump_z, 
                                                               color = NULL, 
                                                               shape = NULL), 
             fill = "#46698C", size = 3, pch = 21) + 
  geom_point(data=trial_holes[7,], mapping=aes(x+hole_bump_x, # methyl benzoate
                                                               z+hole_bump_z, 
                                                               color = NULL, 
                                                               shape = NULL), 
             fill = "#46698C", size = 3, pch = 21) + 
  geom_point(data=trial_holes[8,], mapping=aes(x+hole_bump_x, # blank
                                                               z+hole_bump_z, 
                                                               color = NULL, 
                                                               shape = NULL), 
             fill = "gray30", size = 3, pch = 21) + 
  geom_point(data=trial_holes[9,], mapping=aes(x+hole_bump_x, # HOT
                                                             z+hole_bump_z, 
                                                             color = NULL, 
                                                             shape = NULL), 
             fill = "red", size = 3, pch = 21) +
  xlim(-1.1, 0.5) + ylim(-0.1, 0.8) +
  coord_fixed() +
  ylab(" ") + xlab("Along face of wall")+
  theme_minimal() +theme(legend.position = "none")
  
( p2E1H_casting_density + pAmm_casting_density ) /
  ( p2E1H_casting_cluster + pAmm_casting_cluster ) +
  plot_annotation(tag_levels = "a") + 
  theme(plot.tag = element_text(face = 'bold')) +
  plot_layout(guides = "collect")

```


The casting stage describes the active search of a dog at the edge of a plume before it begins localizing to narrow down the search field to the odor's source. It often involves larger movements and more changes of direction in order to cover a larger area and encounter infrequent odor signals. Fig. \@ref(fig:frontwall-casting) show the density maps of casting across all runs for both target odors. The patterns between the target odors differed significantly, with a difference in the distance of the nose to the target odor source (Fig. \@ref(fig:hole-times)A, means: $`r round(casting_dist_test[["estimate"]][2], digits = 3)`$ m and $`r round(casting_dist_test[["estimate"]][1], digits = 3)`$ m for 2E1H and NH~3~, respectively; $t = `r round(casting_dist_test[["statistic"]], digits = 3)`$; $p = `r signif(casting_dist_test[["p.value"]], digits = 2)`$). The time spent engaging in casting, however, did not differ. Casting occurred further from the face of the wall and spread across the face of the wall (Fig. \@ref(fig:frontwall-casting)), although dogs were found to sniff below the holes more for NH~3~ than 2E1H. K-mean gap scores for clusters were overall low for both 2E1H (`r round(min(cluster_2E1H_casting$cluster_data$gap), digits = 2)` to `r round(max(cluster_2E1H_casting$cluster_data$gap), digits = 2)`) and NH~3~ (`r round(min(cluster_Amm_casting$cluster_data$gap), digits = 2)` to `r round(max(cluster_Amm_casting$cluster_data$gap), digits = 2)`). 


```{r frontwall-detailing, fig.cap="Point-density plots (a and b) and k-means clustering plots (c and d) of the front view of trial wall during localizing stage for 2E1H (a, c) and NH~3~ (b, d). Location of imprinting source holes marked with colored circles (red indicates location of target odorant, blue are distractors, gray is blank).", echo=FALSE, warning=FALSE}

p2E1H_detailing_density <- ggplot(dat_2E1H_detailing, aes(x, z)) + 
  stat_density2d(geom = "polygon", aes(fill=..level.., alpha = ..level..), contour = T) +
  scale_fill_viridis(limits = c(0, 21), name = "density", discrete = F) + 
  scale_alpha_continuous(limits = c(0, 21), name = "", guide = "none") + 
  geom_point(data=trial_holes[7,], mapping=aes(x+hole_bump_x, # blank
                                                               z+hole_bump_z, 
                                                               color = NULL, 
                                                               shape = NULL), 
             fill = "gray30", size = 3, pch = 21) + 
  geom_point(data=trial_holes[8,], mapping=aes(x+hole_bump_x, # methyl benzoate
                                                               z+hole_bump_z, 
                                                               color = NULL, 
                                                               shape = NULL), 
             fill = "#46698C", size = 3, pch = 21) + 
  geom_point(data=trial_holes[9,], mapping=aes(x+hole_bump_x, # bromooctane
                                                               z+hole_bump_z, 
                                                               color = NULL, 
                                                               shape = NULL), 
             fill = "#46698C", size = 3, pch = 21) + 
  geom_point(data=trial_holes[6,], mapping=aes(x+hole_bump_x, # HOT
                                                             z+hole_bump_z, 
                                                             color = NULL, 
                                                             shape = NULL), 
             fill = "red", size = 3, pch = 21) +
  xlim(-1.1, 0.5) + ylim(-0.1, 0.8) +
  coord_fixed() +
  ggtitle("2E1H") +
  ylab("Point density\n\nDistance from floor") + xlab(" ")+
  theme_minimal() + theme(plot.title = element_text(hjust = 0.5))

p2E1H_detailing_cluster <- ggplot(dat_2E1H_detailing, aes(x, z, color = cluster)) + 
  geom_point(pch=19, alpha = 0.1) + 
  stat_ellipse(aes(fill = cluster), type="t", geom = "polygon", alpha=0.4)+
  scale_color_viridis(discrete = T, option = "E") + 
  scale_fill_viridis(discrete = T, option = "E") +
  geom_point(data=trial_holes[7,], mapping=aes(x+hole_bump_x, # blank
                                                               z+hole_bump_z, 
                                                               color = NULL, 
                                                               shape = NULL), 
             fill = "gray30", size = 3, pch = 21) + 
  geom_point(data=trial_holes[8,], mapping=aes(x+hole_bump_x, # methyl benzoate
                                                               z+hole_bump_z, 
                                                               color = NULL, 
                                                               shape = NULL), 
             fill = "#46698C", size = 3, pch = 21) + 
  geom_point(data=trial_holes[9,], mapping=aes(x+hole_bump_x, # bromooctane
                                                               z+hole_bump_z, 
                                                               color = NULL, 
                                                               shape = NULL), 
             fill = "#46698C", size = 3, pch = 21) + 
  geom_point(data=trial_holes[6,], mapping=aes(x+hole_bump_x, # HOT
                                                             z+hole_bump_z, 
                                                             color = NULL, 
                                                             shape = NULL), 
             fill = "red", size = 3, pch = 21) +
  xlim(-1.1, 0.5) + ylim(-0.1, 0.8) +
  coord_fixed() +
  ylab("k-mean clustering\n\nDistance from floor") + xlab("Along face of wall")+
  theme_minimal() 

pAmm_detailing_density <- ggplot(dat_Amm_detailing, aes(x, z)) + 
  stat_density2d(geom = "polygon", aes(fill=..level.., alpha = ..level..), contour = T) +
  scale_fill_viridis(limits = c(0, 21), name = "density", discrete = F) + 
  scale_alpha_continuous(limits = c(0, 21), name = "", guide = "none") + 
  geom_point(data=trial_holes[6,], mapping=aes(x+hole_bump_x, # bromooctane
                                                               z+hole_bump_z, 
                                                               color = NULL, 
                                                               shape = NULL), 
             fill = "#46698C", size = 3, pch = 21) + 
  geom_point(data=trial_holes[7,], mapping=aes(x+hole_bump_x, # methyl benzoate
                                                               z+hole_bump_z, 
                                                               color = NULL, 
                                                               shape = NULL), 
             fill = "#46698C", size = 3, pch = 21) + 
  geom_point(data=trial_holes[8,], mapping=aes(x+hole_bump_x, # blank
                                                               z+hole_bump_z, 
                                                               color = NULL, 
                                                               shape = NULL), 
             fill = "gray30", size = 3, pch = 21) + 
  geom_point(data=trial_holes[9,], mapping=aes(x+hole_bump_x, # HOT
                                                             z+hole_bump_z, 
                                                             color = NULL, 
                                                             shape = NULL), 
             fill = "red", size = 3, pch = 21) +
  xlim(-1.1, 0.5) + ylim(-0.1, 0.8) +
  coord_fixed() +
  ggtitle(bquote(NH[3])) +
  ylab(" ") + xlab(" ")+
  theme_minimal() + theme(plot.title = element_text(hjust = 0.5))

pAmm_detailing_cluster <- ggplot(dat_Amm_detailing, aes(x, z, color = cluster)) + 
  geom_point(pch=19, alpha = 0.1) + 
  stat_ellipse(aes(fill = cluster), type="t", geom = "polygon", alpha=0.4)+
  scale_color_viridis(discrete = T, option = "E") + 
  scale_fill_viridis(discrete = T, option = "E") +
  geom_point(data=trial_holes[6,], mapping=aes(x+hole_bump_x, # bromooctane
                                                               z+hole_bump_z, 
                                                               color = NULL, 
                                                               shape = NULL), 
             fill = "#46698C", size = 3, pch = 21) + 
  geom_point(data=trial_holes[7,], mapping=aes(x+hole_bump_x, # methyl benzoate
                                                               z+hole_bump_z, 
                                                               color = NULL, 
                                                               shape = NULL), 
             fill = "#46698C", size = 3, pch = 21) + 
  geom_point(data=trial_holes[8,], mapping=aes(x+hole_bump_x, # blank
                                                               z+hole_bump_z, 
                                                               color = NULL, 
                                                               shape = NULL), 
             fill = "gray30", size = 3, pch = 21) + 
  geom_point(data=trial_holes[9,], mapping=aes(x+hole_bump_x, # HOT
                                                             z+hole_bump_z, 
                                                             color = NULL, 
                                                             shape = NULL), 
             fill = "red", size = 3, pch = 21) +
  xlim(-1.1, 0.5) + ylim(-0.1, 0.8) +
  coord_fixed() +
  ylab(" ") + xlab("Along face of wall")+
  theme_minimal() +theme(legend.position = "none")
  
( p2E1H_detailing_density + pAmm_detailing_density ) /
  ( p2E1H_detailing_cluster + pAmm_detailing_cluster ) + 
  plot_annotation(tag_levels = "a") + 
  theme(plot.tag = element_text(face = 'bold')) +
  plot_layout(guides = "collect")

```

Localizing describes the behavior in which a dog searches a smaller area to narrow down the position of the odor source. This smaller search area is reflected in the localizing point density of 2E1H (Fig. \@ref(fig:frontwall-detailing)A), with the searching highly localized to the holes of the wall and little deviation from the wall's face. Clustering is highly robust and four of the groups correspond to the four source holes of the wall (Fig. \@ref(fig:frontwall-detailing)C) with gap scores of `r round(cluster_2E1H_detailing$cluster_data$gap[2], digits=2)` to `r round(max(cluster_2E1H_detailing$cluster_data$gap[5]), digits = 2)`. In contrast, NH~3~ localizing, while close to the surface of the wall, was spread both above and below the holes, showing clusters that were less distinct and not associated with individual holes (gap scores: `r round(cluster_Amm_detailing$cluster_data$gap[2], digits=2)` to `r round(max(cluster_Amm_detailing$cluster_data$gap[5]), digits = 2)`). Dogs were on average closer to the target source during localizing NH~3~ (Fig. \@ref(fig:hole-times)A) compared to 2E1H (means: $`r round(detailing_dist_test[["estimate"]][2], digits = 3)`$ m and $`r round(detailing_dist_test[["estimate"]][1], digits = 3)`$ m for 2E1H and NH~3~, respectively; $t = `r round(detailing_dist_test[["statistic"]], digits = 3)`$; $p = `r signif(detailing_dist_test[["p.value"]], digits = 2)`$). Dogs also spent a longer time engaged in localizing for NH~3~ than 2E1H (Fig. \@ref(fig:hole-times)B) (Welch Two Sample t-test; means: $`r round(detailing_tasktime_test[["estimate"]][2], digits = 2)`$ s, $`r round(detailing_tasktime_test[["estimate"]][1], digits = 2)`$ s, $p = `r round(detailing_tasktime_test[["p.value"]], digits = 3)`$). With this, the time dogs engaged in casting as opposed to localizing NH~3~ did not differ (Wilcoxon rank sum exact test, $W = `r am_cast_detail_test$statistic`$, $p = `r round(am_cast_detail_test$p.value, digits = 3)`$), yet the dogs spent significantly less time localizing 2E1H than casting for it (Welch Two Sample t-test; means: $`r round(eh_cast_detail_test[["estimate"]][2], digits = 2)`$ s, $`r round(eh_cast_detail_test[["estimate"]][1], digits = 2)`$ s, $p = `r round(eh_cast_detail_test$p.value, digits = 3)`$). 


```{r hole-times, echo=FALSE, fig.width = 6.5, fig.height = 4.25, fig.cap="Mean distance the dogs occupied in the casting and localizing stages of search (a) as well as the mean time they spent within 10 cm of the source of each chemical (b). * represents a comparison where the p < 0.05."}

p1 <- ggplot(dog_mean_hot_dist, aes(task, value, fill = chemical)) + 
  geom_boxplot() +
  geom_point(position = position_jitterdodge(jitter.width = 0.2), pch = 21, alpha = 0.2) +
  scale_fill_manual(values = c(chem_colors[1], chem_colors[2]), name = "Target odor",
                    labels = c("2E1H", bquote(NH[3]))) +
  annotate(geom = "text", x = 1.7, y = 1.08, label = "**",  size = 6) +
  annotate(geom = "line", x = c(1.15, 2.25), y = c(1.03, 1.03),  linewidth = 1) +
  annotate(geom = "text", x = 2, y = 0.95, label = "***",  size = 6) +
  annotate(geom = "line", x = c(1.75, 2.25), y = c(0.9, 0.9),  linewidth = 1) +
  annotate(geom = "text", x = 1, y = 1.15, label = "*",  size = 6) + 
  annotate(geom = "line", x = c(0.75, 1.25), y = c(1.1,1.1), linewidth = 1) +
  scale_x_discrete(labels = c("Casting", "Localizing")) +
  ylab("Mean distance from target\nodor source (m)") + xlab(" ") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

p2 <- ggplot(dog_mean_total_task_time, aes(task, value, fill = chemical)) +
  geom_boxplot() + 
  geom_point(position = position_jitterdodge(jitter.width = 0.2), pch = 21, alpha = 0.2) +
  scale_fill_manual(values = c(chem_colors[1], chem_colors[2]), name = "Target odor", 
                    guide = "none") +
  scale_x_discrete(labels = task_labs) +
  annotate(geom = "text", x = 3, y = 18, label = "**",  size = 6) +
  annotate(geom = "line", x = c(2.75, 3.25), y = c(17, 17),  linewidth = 1) +
  annotate(geom = "text", x = 2.25, y = 26, label = "*",  size = 6) +
  annotate(geom = "line", x = c(1.75, 2.75), y = c(25, 25),  linewidth = 1) +
  ylab("Mean time spent in\nbehavioral state (s)") + xlab(" ") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

(p1 + p2) + plot_annotation(tag_levels = "a") + 
  theme(plot.tag = element_text(face = 'bold')) +
  plot_layout(guides = "collect")
```



### Dog behavior during search does not change with target odorant


```{r indiv-behavior-times, echo=FALSE, fig.width = 6.5, fig.height = 4.25, fig.cap="Mean time spent showing each of four behaviors (a) and the number of times the dogs displayed each of eight other behaviors (b)."}

p1 <- ggplot(na.omit(dog_mean_event_times), aes(x=task, y=value, 
                                           fill = chemical)) +
  geom_boxplot() +
  geom_point(position = position_jitterdodge(jitter.width = 0.2), pch = 21, alpha = 0.2) +
  geom_hline(yintercept = 0, alpha = 0.5) + 
  scale_x_discrete(labels = state_behavior_labels) +
  scale_fill_manual(values = c(chem_colors[1], chem_colors[2]), name = "Target odor",
                    labels = c("2E1H", bquote(NH[3]))) +
  xlab(" ") + 
  ylab("Time spent engaged\nin behavior (s)") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

p2 <- ggplot(na.omit(dog_point_counts), aes(x = task, y = value, fill = chemical)) + 
  geom_boxplot() +
  geom_point(position = position_jitterdodge(jitter.width = 0.2), pch = 21, alpha = 0.2) +
  scale_x_discrete(labels = point_behavior_labels) +
  scale_fill_manual(values = c(chem_colors[1], chem_colors[2]), name = "Target odor",
                    labels = c("2E1H", bquote(NH[3]))) +
  xlab(" ") + 
  ylab("Number of\ntimes observed") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

(p1 + p2)  + plot_annotation(tag_levels = "a") +
  theme(plot.tag = element_text(face = 'bold')) +
  plot_layout(guides = "collect") 

```

When looking at both the counts and time spent displaying twelve behaviors associated with searching, focus, stress, and alerts, no significant differences were found between the two target odors. In Fig. \@ref(fig:indiv-behavior-times)A, the times the dogs spend displaying four state behaviors was not found to be statistically different based on the target odor  (Two-Way ANOVA, DFs = $`r anv_task_chem_dog_times[["Df"]][2]`, `r anv_task_chem_dog_times[["Df"]][3]`$; F-statistics = $`r round(anv_task_chem_dog_times[["F value"]][2], digits = 2)`, `r round(anv_task_chem_dog_times[["F value"]][3], digits = 3)`$; p values = $`r signif(anv_task_chem_dog_times[["Pr(>F)"]][2], digits=3)`, `r signif(anv_task_chem_dog_times[["Pr(>F)"]][3], digits = 3)`$). No individual comparison between target odor within a specific state were significant. The dogs did display a slight trend towards a difference when looking at the handler based on the target odor. However, a small sample size limited the statistical power of this comparison. 

Furthermore, the time spent sniffing for both target odors did not differ statistically (Welch Two Sample t-test; means: $`r round(sniff_eventtime_test[["estimate"]][2], digits = 3)`$ s, $`r round(sniff_eventtime_test[["estimate"]][1], digits = 3)`$ s, $p = `r round(sniff_eventtime_test[["p.value"]], digits = 3)`$), therefore demonstrating that the dogs spent about equal amounts of time searching for the two odors.

The counts of individual behaviors, including those that signify states of being, also did not result in any significant differences in how the dogs searched for the target odors (Fig. \@ref(fig:indiv-behavior-times)B). While the number of times the dogs turned their heads towards their handlers seemed to trend towards occurring more for NH~3~, the result was also insignificant ($p = `r signif(hturn_point_test[["p.value"]], digits = 3)`$). These results suggest there was no difference in states of being for dogs engaged in searching for either target odor. 

### Search success changes with target odorant


```{r search-times, echo=FALSE, fig.width = 6, fig.height = 4.0, fig.cap="Mean search times between types of runs (b) against alert success for both chemicals (a). Each point represents the mean for a single dog search event b."}

p1 <- ggplot(alerts, aes(x = dog, y = chemical, fill = success)) + 
  geom_tile(color = "black") + 
  scale_fill_manual(values = c("gray50", "gray90"), 
                    labels = c("not successful", "successful"), name = "") +
  scale_x_discrete(limits = rev(levels(alerts$dog))) +
  scale_y_discrete(position = "right", labels = c("2E1H", bquote(NH[3]))) +
  coord_flip()+
  ylab("Target") + xlab("Individual dog") + 
  theme_minimal() + theme(legend.position = "bottom")

p2 <- ggplot(total_search_times, aes(chemical, value, fill = factor(success))) + 
  geom_boxplot() + 
  geom_point(position=position_jitterdodge(dodge.width=0.8, jitter.width = 0.0), 
             alpha = 0.25, pch = 21) +
  scale_x_discrete(labels = c("2E1H", bquote(NH[3]))) +
  #annotate(geom = "text", x = 1, y = 34, label = "*",  size = 7) + 
  #annotate(geom = "line", x = c(0.75, 1.25), y = c(32,32), linewidth = 1) +
  scale_fill_manual(values = c("gray50", "gray90"), 
                    labels = c("not successful", "successful"), name = "") +
  ylab("Total time engaged\nin search (s)") + xlab(" ") + 
  theme_minimal() + theme(legend.position = "bottom")
(p1 + p2) + plot_annotation(tag_levels = "a") +
  theme(plot.tag = element_text(face = 'bold')) +
  theme(legend.position = 'bottom')

```


```{r search-time-test, include=FALSE}
eh_total_time_succ <- total_search_times$value[total_search_times$chemical =="2E1H" & total_search_times$success == TRUE]
eh_total_time_notsucc <- total_search_times$value[total_search_times$chemical =="2E1H" & total_search_times$success == FALSE]
eh_time_succ_test <- wilcox.test(eh_total_time_succ, eh_total_time_notsucc)

am_total_time_succ <- total_search_times$value[total_search_times$chemical =="Ammonia" & total_search_times$success == T]
am_total_time_notsucc <- total_search_times$value[total_search_times$chemical =="Ammonia" & 
                                                    total_search_times$success == F]
am_search_times <- wilcox.test(am_total_time_succ, am_total_time_notsucc)

succ_search_times <- wilcox.test(am_total_time_succ, eh_total_time_succ)

not_succ_search_times <- wilcox.test(am_total_time_notsucc, eh_total_time_notsucc)
```

If the behaviors and kinematics along the sniff path changed depending on the target odor, it would follow that the search success would also differ (see Fig. \@ref(fig:search-times)A). The dogs were more successful at finding the NH~3~ source over 2E1H (Fisher's exact test, $p = `r round(alert_test$p.value, digits = 3)`$; Fig. \@ref(fig:search-times)A). With this search success difference, a difference in the total time engaged for each target odor between successful and unsuccessful was not found. The successful searches did not differ in time from the unsuccessful searches for both chemicals (Wilcoxon rank sum exact test, $W = `r am_search_times$statistic`$, $p = `r round(am_search_times$p.value, digits = 3)`$ for NH~3~ and $W = `r eh_time_succ_test$statistic`$, $p = `r round(eh_time_succ_test$p.value, digits = 3)`$ for 2E1H) or between the chemicals (Wilcoxon rank sum exact test, $W = `r succ_search_times$statistic`$, $p = `r round(succ_search_times$p.value, digits = 3)`$ for successful searches and $W = `r not_succ_search_times$statistic`$, $p = `r round(not_succ_search_times$p.value, digits = 3)`$ for unsuccessful searches; Fig. \@ref(fig:search-times)B). 



## Discussion


The target odorants in this study possess differences in physical properties such that during close-quarters searching transport of odorant would be dominated by advection during casting for both odorants, and then diffusion for NH~3~ and advection for 2E1H during localizing (Table \@ref(tab:pe-table)). We predicted that this would result in significant differences in the way dogs would search odor plumes created by each target odorant, displayed by differences in movement, behavior stages of the search, and individual behaviors associated with focus and distress. 

During casting, dogs approached the wall and worked between 0.2 and 1 m away from the wall ($x$ axis for Fig. \@ref(fig:frontwall-detailing)). The dogs were further away as they approached the NH~3~ source, although the distribution of movement and time spent casting were similar for both chemicals (Fig. \@ref(fig:frontwall-casting) and \@ref(fig:hole-times)B). The mean distance of the dogs' noses were further away from the location of the source for NH~3~ than 2E1H (Figs. \@ref(fig:hole-times)A), although the distribution of movement and time spent casting were similar for both chemicals (Fig. \@ref(fig:frontwall-casting) and \@ref(fig:hole-times)B). 

When dogs transitioned to localizing, the $Pe$ dropped to less than 1 for NH~3~, signifying a diffusion-based transport at this distance from the source. In this search stage, the dogs patterned their localizing behaviors differently for each target odorant, tending to search each imprinting hole more thoroughly and closely for 2E1H while hovering around the source hole for NH~3~ (Fig. \@ref(fig:frontwall-detailing)C & D). This behavior resulted in a closer mean distance between the dogs' noses and the odor source during localizing NH~3~ compared to 2E1H or when casting for NH~3~ (Fig. \@ref(fig:hole-times)A).  Additionally, the dogs spent more time closer to the source for NH~3~ than 2E1H (Figs. \@ref(fig:hole-times)B). 

Furthermore, weather conditions at the trial were humid (80% relative humidity). In the presence of water vapor, NH~3~ forms a hydrated complex and becomes heavier than air. Accordingly, there was a vertical shift downward below the imprinting holes for both casting and localizing for NH~3~ as compared to 2E1H (Figs. \@ref(fig:frontwall-casting) & \@ref(fig:frontwall-detailing)), reflecting this property of NH~3~. The same was not observed for 2E1H. 

Although the movements of dogs during the searches differed, individual behaviors did not (Fig. \@ref(fig:indiv-behavior-times)). Individual behaviors were selected based on their connection with states of focus and distress [@bodnariu2008indicators; @melco2020investigation; @thesen1993behaviour]. Results indicated that dogs engaged in the same set of behaviors for each chemical, maintaining similar levels of focus and distress implying that the dogs were neither averse to the target odorants nor experienced different levels of distress during the trial searches. There was a slight, but insignificant, trend toward dogs looking at their handlers during the NH~3~ search unrelated to alert trained final responses, which may have reached significance with a larger sample size. 

We predicted that the difference in physical properties between the two target odorants would lead to dogs having more success at finding 2E1H as it is more similar to the Nosework odors that the dogs had been previously trained to locate. Nosework odors, the essential oils of birch, anise, and clove, are more similar in physical properties to 2E1H; consisting broadly of turpenes which have more similar vapor pressures and diffusivities to 2E1H compared to NH~3~. However, dogs successfully alerted on NH~3~ significantly more often than 2E1H (Fig. \@ref(fig:search-times)A) while spending similar amounts of time searching for each odor (Fig. \@ref(fig:search-times)B).

Together, these results suggest that the physical properties of NH~3~ and 2E1H influence the movement of the dogs during search. Many handlers reported that their dogs seemed to react differently in movement and search patterning during training with NH~3~ as compared to training with 2E1H. NH~3~ seemed to present a novel challenge for the dogs. The differences in plume characteristics between the two target odorants in this study made it easier for dogs to identify the edges of the plume during casting for NH~3~ but required the dogs to allocate different amounts of time and effort between the two odorants during localizing. It also required searching in different areas with different movements in response to the difference in plume characteristics between NH~3~ and 2E1H. 

When very close to the source, the differences in $Pe$ between NH~3~ and 2E1H span $Pe=1$, the critical ratio that determines the dominant mode of transport for each odorant (Table \@ref(tab:pe-table)). Other studies investigating odor capture by crabs across this $Pe$ value between air and water found support for morphological and kinematic differences being a result of performance differences of capture in the two fluid environments [@Waldrop:bluehermit; @Waldrop:entmodel]. This transition corresponds roughly to the behavioral transition between casting and localizing, observed by many studies that show distinct changes in behavior when an animal is so close to the source that the intermittent cues of a plume become less reliable [@weissburg1994odor; @Ache:2005; @liu2020mouse]. Our results are consistent with these observations and suggest that the target odorant's diffusivity can drive where and when this transition occurs for dogs during a search. 

Few studies have investigated kinematic or behavioral changes of animals engaged in searching for odorants of different physical properties. Most odors are a mixture of individual chemical odorants, each with their own physical properties [@Ache:2005]. Many common explosives give off multiple chemical odorants, and when trained dogs are tested with odorants individually, they are less proficient in detection [@lorenzo2003laboratory; @harper2005identification]. Each odorant has individual physical properties, such as diffusion, which can influence the shape of the plume or the spatial and temporal pattern of signals delivered to dogs [@wang2021chemical; @heilman2014wildland; @asif2018air]. It is possible that dogs use not only the spatial and temporal information from each odorant as it is transported in the plume, but also the changing chemical makeup of the odor that they capture during different stages of the search. 

Understanding that the dog's movements during a search will be different, while individual behaviors may not, is important for the handler when reading their dog's behavior during a search. Trained final responses are not the only signals handlers should learn to discriminate, the specific behaviors and movements of dogs during the search can be nuanced and indicate the stage of the search activity, the possible locations of sources, and possibly the type of odors. Better understand of differences in the search process can improve a handler's ability to intervene and guide the dog, communicate with other people, improve reliability, and maintain safety in a dangerous working environment [@jezierski2008information; @boedeker2012sniffer; @wells2003directional;@southwest1973narcotic; @gazit2003explosives; @theuriexplosive]. 

This novel exploration into the detailed ways that dogs search for odors based on the physical properties of odorants can also be useful for the wider investigation into and creation of artificial sensors. The awareness that search patterning is an effective tool for various targets without requiring a change in strategy is beneficial. Search patterns, such as the zig-zag and spiral search patterns, as well as other sniff searching information have been taken from the organic models and have been useful for biomimetic or bioinspired use in robotics work [@lochmatter2007odor, @staymates2016biomimetic, @russell2001survey, and @hayes2002distributed]. The continued investigation into how animals search and how searching is influenced by various factors will aid in the growth of artificial sensors and their ability to discriminate and locate specific odors.

Fourteen dogs participated and while this sample size was acceptable and gathered telling data, it may have also served as a limitation, as evidenced by a trend, and non-significant result for more time spent looking at the handler when searching for NH~3~. A larger sample size may have provided more statistically significant results for the study of individual behaviors and for alert success. With this, the dogs were only trained for six weeks on the target chemicals, and while there was a clear difference in their ability to and in how they searched for the odors, these differences may have been affected by the length and presence of training. Moreover, operational dogs were not utilized, instead, Nosework dogs registered through the National Association of Canine Scent Work^TM^ participated. This may have been a limitation as there may be behavioral or search pattern differences between operational and non-operational dogs, yet the use of non-operational dogs is consistent with the participant population of the wider literature [@jezierski2008information; @concha2014using; @hepper2005many].  These limitations serve as a call for continued exploration on the subject to propel beneficial developments of canine searching for all operational capacities.


The findings from the present study demonstrate that the physical properties of target odors affect the search behaviors of dogs, namely the kinematic motions used to search for odors. While individual behaviors along the search were not found to differ between the two odors, dogs searched widely around the source hole for  NH~3~, while they consistently searched for 2E1H close to the imprinting holes. The results of the behavioral and kinematic analyses were concordant with the known fluid dynamic behavior of the target odors, thereby providing evidence that the physical properties of odors affect the search behavior of dogs. Future work should continue to study and seek to understand the behaviors along the search, including movement patterns and behaviors, to provide the operational and nose work communities with better information and tools for working with their canine partners.


## Acknowledgements

This study was funded by Office of Naval Research awards #N00014-21-1-2347 (to L. Waldrop) and #N00014-21-1-2873 (to L. DeGreeff). The authors wish to thank Brandi Bryant and Jenny Brackett of the The Hounds Grounds in Huntington Beach, CA for providing the venue for the trials; Amy Herot and Jill-Marie O'Brien from NASCW for help in recruiting participants; the dog-handler teams for donating their time and effort; and Monica Moljo, Alexa Ortega, Alexander Orlove, and Evan Hughes for helping at the trials.

## Author Contributions

 - DM: Ran trials, created ethogram, analyzed data, wrote manuscript
 - LB, NH: ran trials, analyzed data, wrote manuscript
 - PS: ran trials, wrote manuscript
 - AS,CC: analyzed kinematics, wrote manuscript
 - LD: conceived of idea, ran trials, wrote manuscript
 - LDW: conceived of idea, ran trials, analyzed data, wrote manuscript

## Competing Interests Statement

No authors have no competing interests. 


## Data Availability

All data and code used to produce results can be found on Github at https://github.com/lindsaywaldrop/odor-plume-search. 


## References 
